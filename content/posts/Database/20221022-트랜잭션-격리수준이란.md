---
title: "íŠ¸ëœì­ì…˜ì˜ ê²©ë¦¬ìˆ˜ì¤€(Isolation level)ì´ë€?"
date: 2022-10-22
tags: ["Database", "MySQL", "Isolation Level"]
draft: false
---

# íŠ¸ëœì­ì…˜ì˜ ê²©ë¦¬ìˆ˜ì¤€ì´ë€?

íŠ¸ëœì­ì…˜ì˜ ê²©ë¦¬ ìˆ˜ì¤€ì´ë€ ì—¬ëŸ¬ íŠ¸ëœì­ì…˜ì´ ë™ì‹œì— ì²˜ë¦¬ë  ë•Œ íŠ¹ì • íŠ¸ëœì­ì…˜ì´ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì—ì„œ ë³€ê²½í•˜ê±°ë‚˜ ì¡°íšŒí•˜ëŠ” ë°ì´í„°ë¥¼ ë³¼ ìˆ˜ ìˆê²Œ í—ˆìš©í• ì§€ ë§ì§€ë¥¼ ê²°ì •í•˜ëŠ” ê²ƒì´ë‹¤. íŠ¸ëœì­ì…˜ì˜ ê²©ë¦¬ ìˆ˜ì¤€ì€ ë§¤ìš° ì¤‘ìš”í•œ ê°œë…ì´ë‹¤. ê²©ë¦¬ ìˆ˜ì¤€ì„ ì–´ë–»ê²Œ ì„¤ì •í•˜ëŠëƒì— ë”°ë¼ ë°ì´í„°ì˜ ë¶€ì •í•© ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ë„ ìˆê³  ì„±ëŠ¥ì´ ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆë‹¤.

ê²©ë¦¬ ìˆ˜ì¤€ì—ëŠ” `READ UNCOMMITTED` (Level0), `READ COMMITTED` (Level1), `REPEATABLE READ` (Level2), `SERIALIZABLE` (Level3)ì´ ì¡´ì¬í•˜ë©° ë ˆë²¨ì´ ì˜¤ë¥¼ìˆ˜ë¡ íŠ¸ëœì­ì…˜ê°„ì˜ ê²©ë¦¬ ìˆ˜ì¤€ì´ ë†’ì•„ì ¸ì„œ ì²˜ë¦¬ ì„±ëŠ¥ì´ ë–¨ì–´ì§„ë‹¤. ë°˜ëŒ€ë¡œ ê²©ë¦¬ ìˆ˜ì¤€ì´ ë‚®ì•„ì§ˆìˆ˜ë¡ ë™ì‹œ ì²˜ë¦¬ ì„±ëŠ¥ì€ í–¥ìƒë˜ì§€ë§Œ ê°ê° ìƒˆë¡œìš´ ë°ì´í„° ë¶€ì •í•© ë¬¸ì œë“¤ì´ ë°œìƒí•œë‹¤.

> ê²©ë¦¬ ìˆ˜ì¤€ì´ ì˜¬ë¼ê°ˆìˆ˜ë¡ ì²˜ë¦¬ ì„±ëŠ¥ì˜ ì €í•˜ëŠ” ì¡´ì¬í•˜ì§€ë§Œ `SERIALIZABLE` ê²©ë¦¬ ìˆ˜ì¤€ì´ ì•„ë‹ˆë©´ í¬ê²Œ ì„±ëŠ¥ ì°¨ì´ê°€ ë°œìƒí•˜ì§€ëŠ” ì•ŠëŠ”ë‹¤. ì´ëŸ¬í•œ ì´ìœ  ë•Œë¬¸ì— `SERIALIZABLE`ì€ ë™ì‹œì„±ì´ ì¤‘ìš”í•œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œëŠ” ê±°ì˜ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ”ë‹¤.
>

# ë°ì´í„° ë¶€ì •í•© ë¬¸ì œ

ì•ì„œ íŠ¸ëœì­ì…˜ì˜ ê²©ë¦¬ ìˆ˜ì¤€ì´ ë‚®ì•„ì§ˆìˆ˜ë¡ ìƒˆë¡œìš´ ë°ì´í„° ë¶€ì •í•© ë¬¸ì œë“¤ì´ ì¡´ì¬í•œë‹¤ê³  ì–¸ê¸‰í•˜ì˜€ë‹¤. ë°ì´í„° ë¶€ì •í•© ë¬¸ì œëŠ” Dirty Read, Non-Repeatable Read, Phantom Readê°€ ì¡´ì¬í•˜ë©° ê°ê°ì˜ ê²©ë¦¬ ìˆ˜ì¤€ë³„ ë°œìƒ ìœ ë¬´ëŠ” ì•„ë˜ì˜ í‘œì™€ ê°™ë‹¤.

|  | Dirty Read | Non-Repeatable Read | Phantom Read |
| --- | --- | --- | --- |
| READ UNCOMMITTED | O | O | O |
| READ COMMITTED | X | O | O |
| REPEATALE READ | X | X | O (InnoDBëŠ” X) |
| SERIALIZABLE | X | X | X |

SQLí‘œì¤€ì— ë”°ë¥´ë©´ REPEATABLE READ ê²©ë¦¬ìˆ˜ì¤€ì—ì„œëŠ” Phantom Readê°€ ë°œìƒí•œë‹¤ê³  ì„¤ëª…í•œë‹¤. í•˜ì§€ë§Œ MySQLì˜ ìŠ¤í† ë¦¬ì§€ ì—”ì§„ ì¤‘ InnoDBì˜ ê²½ìš°ëŠ” REPEATABLE READ ê²©ë¦¬ìˆ˜ì¤€ì—ì„œ Phantom Readê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤. ê·¸ ì´ìœ ëŠ” ë’¤ì—ì„œ ì‚´í´ë³´ê² ë‹¤. ê·¸ëŸ¼ ì§€ê¸ˆë¶€í„° ê°ê°ì˜ ê²©ë¦¬ ìˆ˜ì¤€ê³¼ ë¶€ì •í•© ë¬¸ì œë“¤ì„ ì‚´í´ë³´ê² ë‹¤.

> ë°ì´í„° ê²©ë¦¬ ìˆ˜ì¤€ë³„ DBì˜ ë™ì‘ ê³¼ì •ì€ MySQLì„ ê¸°ì¤€ìœ¼ë¡œ í•˜ì˜€ê¸°ì— ë‹¤ë¥¸ DBMSëŠ” ë™ì‘ì´ ì¡°ê¸ˆ ë‹¤ë¥¼ ìˆ˜ ìˆëŠ” ì ì„ ì•Œì•„ë‘ì.
>

# Level0. READ UNCOMMITTED

READ UNCOMMITTEDê²©ë¦¬ ìˆ˜ì¤€ì—ì„œëŠ” íŠ¸ëœì­ì…˜ì˜ ë³€ê²½ ë‚´ìš©ì„ Commit, Rollback ì—¬ë¶€ì— ìƒê´€ì—†ì´ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤. í•´ë‹¹ ê²©ë¦¬ ìˆ˜ì¤€ì€ ì½ê¸°ì— ëŒ€í•´ì„œ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ê³¼ì˜ ê²©ë¦¬ê°€ ë˜ì§€ ì•Šì€ ìƒíƒœì´ê¸° ë•Œë¬¸ì— ë°ì´í„° ë¶€ì •í•© ë¬¸ì œë¡œ ë°œìƒí•  ìˆ˜ ìˆëŠ” **Dirty Read, Non-Repeatable Read, Phantom Readê°€ ëª¨ë‘ ë°œìƒí•  ìˆ˜ ìˆë‹¤.**

Non-Repeatable Read, Phantom ReadëŠ” ì´í›„ì˜ ê²©ë¦¬ìˆ˜ì¤€ì—ì„œ ì°¨ê·¼ì°¨ê·¼ ì•Œì•„ë³´ë„ë¡ í•˜ê³  READ UNCOMMITTEDì—ì„œë§Œ ë°œìƒí•˜ëŠ” Dirty Readì— ëŒ€í•´ ìì„¸íˆ ì‚´í´ë³´ê² ë‹¤.

![Untitled](image/20221022-íŠ¸ëœì­ì…˜-ê²©ë¦¬ìˆ˜ì¤€ì´ë€/img.png)

ì‚¬ìš©ì Aê°€ ë°ì´í„°ë¥¼ Insertí•˜ê³  íŠ¸ëœì­ì…˜ì´ Commitë˜ê¸° ì „ì— ì‚¬ìš©ì BëŠ” Insertëœ ë°ì´í„°ë¥¼ ë³¼ ìˆ˜ ìˆë‹¤. ì´ ë•Œ ì‚¬ìš©ì Aì˜ íŠ¸ëœì­ì…˜ì´ ì •ìƒì ìœ¼ë¡œ Commitë˜ë©´ ë¬¸ì œê°€ ì—†ì§€ë§Œ ë§Œì•½ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì—¬ Rollbackì´ ë°œìƒí•  ê²½ìš°, Insertëœ ë°ì´í„°ëŠ” ì‚­ì œë˜ê²Œ ë  ê²ƒì´ë‹¤. í•˜ì§€ë§Œ ì‚¬ìš©ì Bì˜ íŠ¸ëœì­ì…˜ì—ì„œëŠ” ì´ë¯¸ Insertëœ ë°ì´í„°ë¥¼ ì½ì–´ê°”ê³  í•´ë‹¹ ë°ì´í„°ê°€ ì •ìƒì ì¸ ë°ì´í„°ë¼ê³  ìƒê°í•  ê²ƒì´ë‹¤. ì´ì™€ ê°™ì´ Uncommitted ê²°ê³¼ë¥¼ ë‹¤ë¥¸ íŠ¸ëœì ì…˜ì—ì„œ í™•ì¸í•˜ëŠ” í˜„ìƒì„ **Dirty Readë¼ê³ ** í•œë‹¤.

ë”í‹° ë¦¬ë“œ í˜„ìƒì„ ë°œìƒì‹œí‚¤ëŠ” READ UNCOMMITTED ê²©ë¦¬ ìˆ˜ì¤€ì€ RDMBS í‘œì¤€ì—ì„œ íŠ¸ëœì­ì…˜ì˜ ê²©ë¦¬ ìˆ˜ì¤€ìœ¼ë¡œ ì¸ì •í•˜ì§€ ì•Šì„ ì •ë„ë¡œ ì •í•©ì„±ì— ë¬¸ì œê°€ ë§ê¸°ì— í•´ë‹¹ ê²©ë¦¬ ìˆ˜ì¤€ì€ ì´ìƒì„ ì‚¬ìš©í•  ê²ƒì„ ê¶Œì¥í•œë‹¤. ì‹¤ì œë¡œ Oracle DBì—ì„œë„ í•´ë‹¹ ê²©ë¦¬ìˆ˜ì¤€ì€ ì§€ì›í•˜ì§€ ì•ŠëŠ”ë‹¤.

# Level 1. READ COMMITTED

READ COMMITTEDê²©ë¦¬ìˆ˜ì¤€ì€ íŠ¹ì • íŠ¸ëœì­ì…˜ì—ì„œ ë°ì´í„°ë¥¼ ë³€ê²½í•˜ì˜€ë”ë¼ë„ Commitì´ ì™„ë£Œëœ ë°ì´í„°ë§Œ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì—ì„œ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤. ë•ë¶„ì— ì•ì„œ READ UNCOMMITTEDì—ì„œ ë°œìƒí•˜ì˜€ë˜ ë”í‹° ë¦¬ë“œê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.

í•´ë‹¹ ê²©ë¦¬ìˆ˜ì¤€ì—ì„œëŠ” ì–¸ë‘ë¡œê·¸ë¥¼ ì´ìš©í•´ íŠ¹ì • íŠ¸ëœì­ì…˜ì—ì„œ ë°ì´í„°ë¥¼ ë³€ê²½í•˜ê³  Commitì´ ë˜ê¸° ì „ì— ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì—ì„œ í•´ë‹¹ ë°ì´í„°ë¥¼ ì¡°íšŒí•  ë•Œ ë³€ê²½ ì´ì „ì˜ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ë„ë¡ í•˜ê³  ìˆë‹¤. ë°ì´í„°ì˜ ë³€ê²½ì´ ë°œìƒí•˜ë©´ ë³€ê²½ ì´ì „ ë°ì´í„°ë¥¼ ì–¸ë‘(Undo)ë¡œê·¸ì— ë³µì‚¬í•˜ê³  ì¡°íšŒ ìš”ì²­ì´ ì˜¤ë©´ ì–¸ë‘ë¡œê·¸ì˜ ë°ì´í„°ë¥¼ ë°˜í™˜í•˜ëŠ” êµ¬ì¡°ë¡œ ë™ì‘í•˜ì—¬ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ë“¤ì—ê²ŒëŠ” ë³€ê²½ ì´ì „ì˜ ë°ì´í„°ë¥¼ ë³´ì—¬ì£¼ëŠ” êµ¬ì¡°ë¡œ ë™ì‘í•˜ê³  ìˆë‹¤. ì•„ë˜ì˜ ê·¸ë¦¼ì„ ì°¸ì¡°í•˜ë©´ ì´í•´ê°€ ë¹ ë¥¼ ê²ƒì´ë‹¤.

![Untitled](image/20221022-íŠ¸ëœì­ì…˜-ê²©ë¦¬ìˆ˜ì¤€ì´ë€/img_1.png)

READ COMMITTEDëŠ” ì–¸ë‘ë¡œê·¸ë¥¼ í™œìš©í•˜ì—¬ ë”í‹° ë¦¬ë“œë¥¼ í•´ê²°í•˜ì˜€ë‹¤. í•˜ì§€ë§Œ í•´ë‹¹ ê²©ë¦¬ìˆ˜ì¤€ì€ ë³€ê²½ ë°ì´í„°ì˜ ì»¤ë°‹ì´ ë˜ê¸° ì´ì „ì—ëŠ” ì–¸ë‘ ë¡œê·¸ì˜ ë°ì´í„°ë¥¼ ë°˜í™˜í•˜ê³  ì»¤ë°‹ì´ ëœ ì´í›„ì—ëŠ” ì›ë³¸ ë°ì´í„°ë¥¼ ë°˜í™˜í•˜ëŠ” êµ¬ì¡°ë¡œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì— ì—¬ì „íˆ **Non-Repeatable Read, Phantom Read ë¬¸ì œê°€ ì¡´ì¬**í•œë‹¤. Non-Repeatable Readê°€ ë¬´ì—‡ì¸ì§€ì— ëŒ€í•´ì„œëŠ” ì•„ë˜ì˜ ê·¸ë¦¼ì„ ì‚´í´ë³´ê² ë‹¤.

![Untitled](image/20221022-íŠ¸ëœì­ì…˜-ê²©ë¦¬ìˆ˜ì¤€ì´ë€/img_2.png)

ì‚¬ìš©ì B íŠ¸ëœì­ì…˜ì€ íŠ¸ëœì­ì…˜ì´ ì‹œì‘í•˜ê³  2ë²ˆ idë¥¼ ê°€ì§„ ëª¨ì„ì„ ì¡°íšŒí•˜ëŠ” ì¡°íšŒ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ì˜€ì„ ë•Œ â€œê´‘êµì‚° ë“±ì‚° ëª¨ì„â€ ë°ì´í„°ê°€ ì¡°íšŒë˜ì—ˆë‹¤. í•˜ì§€ë§Œ ë‘ë²ˆì§¸ ì¡°íšŒë¥¼ í•˜ê¸° ì´ì „ì— ì‚¬ìš©ì Aì˜ íŠ¸ëœì­ì…˜ì—ì„œ í•´ë‹¹ ëª¨ì„ì˜ ì´ë¦„ì„ ë³€ê²½í•˜ê³  ì»¤ë°‹ê³¼ì •ê¹Œì§€ ëª¨ë‘ ì´ë£¨ì–´ì ¸ ì‚¬ìš©ì Bì˜ ë‘ ë²ˆì§¸ ì¿¼ë¦¬ì—ì„œëŠ” ì²« ë²ˆì§¸ì™€ ë‹¤ë¥¸ ë°ì´í„°ê°€ ì¡°íšŒë˜ëŠ” ìƒí™©ì´ ì´ë£¨ì–´ì¡Œë‹¤.

ì¦‰, í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ì—ì„œ ê°™ì€ ë°ì´í„°ë¥¼ ë‘ ë²ˆ ì¡°íšŒí•˜ì˜€ì„ ë•Œ ê°™ì€ ê²°ê³¼ë¥¼ ê°€ì ¸ì™€ì•¼ í•œë‹¤ëŠ” REPEATABLE READì •í•©ì„±ì— ì–´ê¸‹ë‚˜ê²Œ ëœë‹¤. ì´ëŸ¬í•œ ë°ì´í„° ë¶€ì •í•© ë¬¸ì œë¥¼ **Non Repeatable Read**ë¼ê³  í•œë‹¤.

> ğŸ“ŒÂ READ COMMITTEDëŠ” Oracle DBMSì—ì„œ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ê²©ë¦¬ ìˆ˜ì¤€ì´ë©° ì˜¨ë¼ì¸ ì„œë¹„ìŠ¤ì—ì„œ ê°€ì¥ ë§ì´ ì‚¬ìš©ë˜ëŠ” ê²©ë¦¬ ìˆ˜ì¤€ì´ë‹¤.
>

# Level2. REPEATABLE READ

ì´ì „ ê²©ë¦¬ ìˆ˜ì¤€ì¸ READ COMMITTEDì—ì„œëŠ” íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ì‹¤í–‰ë˜ëŠ” Selectì¿¼ë¦¬ì™€ íŠ¸ëœì­ì…˜ ì—†ì´ ì‹¤í–‰ë˜ëŠ” Selectì¿¼ë¦¬ì˜ ì°¨ì´ê°€ ë³„ë¡œ ì—†ë‹¤. ê·¸ ê²°ê³¼ **Non Repeatable Read**ê°€ ë°œìƒí•˜ê¸°ë„ í•˜ì˜€ë‹¤. REPEATABLE READ ê²©ë¦¬ ìˆ˜ì¤€ì—ì„œëŠ” Select ì¿¼ë¦¬ë„ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ ì•ˆì—ì„œ ìˆ˜í–‰í•˜ì—¬ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì—ì„œ íŠ¹ì • ê°’ì„ ë³€ê²½í•˜ë”ë¼ë„ ê°™ì€ ì¡°íšŒ ì¿¼ë¦¬ì— ëŒ€í•´ì„œëŠ” í•­ìƒ ë™ì¼í•œ ê²°ê³¼ë¥¼ ë°˜í™˜í•´ì¤€ë‹¤.

MySQLì˜ InnoDBëŠ” MVCC(Multi Version Concurrency Control) ë°©ì‹ìœ¼ë¡œ íŠ¸ëœì­ì…˜ì´ Rollbackë  ê°€ëŠ¥ì„±ì„ ëŒ€ë¹„í•´ ë³€ê²½ ì „ ë°ì´í„°ë“¤ì„ ì–¸ë‘ë¡œê·¸ì— ë°±ì—…í•œ í›„ì— ë°ì´í„° ë³€ê²½ì„ ì§„í–‰í•œë‹¤. READ COMMITTEDëŠ” ì´ëŸ¬í•œ MVCCë¥¼ ìœ„í•´ ì–¸ë‘ ì˜ì—­ì— ë°±ì—…í•´ë‘” ë°ì´í„°ë¥¼ ì´ìš©í•´ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ì—ì„œ ë°œìƒí•˜ëŠ” ê°™ì€ ì¡°íšŒ ì¿¼ë¦¬ì— ëŒ€í•´ì„œëŠ” ë™ì¼í•œ ê²°ê³¼ë¥¼ ë³´ì¥í•˜ê³  ìˆë‹¤. ì¦‰, **Non Repeatable Read**ë¥¼ ë°œìƒì‹œí‚¤ì§€ ì•ŠëŠ” ê²ƒì´ë‹¤.

> ì•ì„œ READ COMMITTEDì—ì„œë„ ì–¸ë‘ë¡œê·¸ë¥¼ ì‚¬ìš©í•œë‹¤ê³  ì–¸ê¸‰í•œ ë°” ìˆë‹¤. READ COMMITTEDì—ì„œëŠ” **Non Repeatable Read**ê°€ ë°œìƒí•˜ê³ , REPEATABLE READì—ì„œ ë°œìƒí•˜ì§€ ì•ŠëŠ” ì´ìœ ëŠ” ë‘ ê²©ë¦¬ ìˆ˜ì¤€ì—ì„œ ì–¸ë‘ ì˜ì—­ì„ ëª‡ ë²ˆì§¸ ì´ì „ê¹Œì§€ ì°¾ì•„ê°€ëŠ”ì§€ì— ëŒ€í•œ ì°¨ì´ê°€ ìˆê¸° ë•Œë¬¸ì´ë‹¤.
>

ê·¸ëŸ¼ REPEATABLE READì˜ ë™ì‘ ê³¼ì •ì„ ì‚´í´ë³´ë©° ì–´ë–»ê²Œ Non Repeatable Readê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ì§€ ì•Œì•„ë³´ê² ë‹¤.

![Untitled](image/20221022-íŠ¸ëœì­ì…˜-ê²©ë¦¬ìˆ˜ì¤€ì´ë€/img_3.png)

ì‚¬ìš©ìA, BëŠ” ê°ê° IDê°€ 7, 10ì¸ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ë™ì‘í•˜ê³  ìˆë‹¤. ì‚¬ìš©ì Bì—ì„œ Selectì¡°íšŒë¥¼ í•˜ì˜€ëŠ”ë° ì´ë•Œ REPEATABLE READëŠ” ìì‹ ì´ ë¶€ì—¬ë°›ì€ íŠ¸ëœì­ì…˜ IDë³´ë‹¤ ë” ì‘ì€ íŠ¸ëœì­ì…˜ì—ì„œ ë³€ê²½í•œ ë°ì´í„°ë§Œ ë³¼ ìˆ˜ ìˆì–´ì„œ 7ë²ˆ IDì—ì„œ ë§ˆì§€ë§‰ìœ¼ë¡œ ì»¤ë°‹ëœ ê²°ê³¼ë¥¼ ì¡°íšŒí•˜ì˜€ë‹¤. ê·¸ ì´í›„ì— ì‚¬ìš©ì Aì˜ íŠ¸ëœì­ì…˜ì¸ 10ë²ˆì´ ì‹œì‘ë˜ê³  ë°ì´í„°ë¥¼ ë³€ê²½ ë° ì»¤ë°‹í•˜ì˜€ë‹¤. í•˜ì§€ë§Œ ì‚¬ìš©ì Bì˜ íŠ¸ëœì­ì…˜ì€ ë³¸ì¸ë³´ë‹¤ ì‘ì€ IDì˜ íŠ¸ëœì­ì…˜ë§Œ ì¡°íšŒí•  ìˆ˜ ìˆê¸°ì— 10ë²ˆ íŠ¸ëœì­ì…˜ì—ì„œ ë³€ê²½ëœ ê°’ì´ ì•„ë‹Œ ì—¬ì „íˆ 7ë²ˆ íŠ¸ëœì­ì…˜ì˜ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ì—¬ Non Repeatable Readê°€ ë°œìƒí•˜ì§€ ì•Šì•˜ë‹¤.

í•˜ì§€ë§Œ REPEATABLE READ ê²©ë¦¬ìˆ˜ì¤€ì—ì„œë„ **Phantom readê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.** Phantom ReadëŠ” í•œ íŠ¸ëœì­ì…˜ ì•ˆì—ì„œ ì¼ì • ë²”ìœ„ì˜ ë ˆì½”ë“œë¥¼ ë‘ ë²ˆ ì´ìƒ ì½ì—ˆì„ ë•Œ, ì²«ë²ˆì§¸ ì¿¼ë¦¬ì—ì„œ ì—†ë˜ ë ˆì½”ë“œê°€ ë‘ë²ˆì§¸ ì¿¼ë¦¬ì—ì„œ ë‚˜íƒ€ë‚˜ëŠ” í˜„ìƒì´ë‹¤. ê¸€ë¡œë§Œ ë´¤ì„ ë•ŒëŠ” ì´í•´ê°€ ì–´ë ¤ìš°ë‹ˆ ì•„ë˜ì˜ ê·¸ë¦¼ì„ í†µí•´ìì„¸íˆ ì‚´í´ë³´ê² ë‹¤.

![Untitled](image/20221022-íŠ¸ëœì­ì…˜-ê²©ë¦¬ìˆ˜ì¤€ì´ë€/img_4.png)

ê·¸ë¦¼ì„ ì‚´í´ë³´ë©´ ì‚¬ìš©ì Bê°€ ì²«ë²ˆì§¸ `SELECT FOR UPDATE` ì¿¼ë¦¬ë¥¼ ë‚ ë ¸ì„ ë•ŒëŠ” 1ê°œì˜ ë°ì´í„°ë¥¼ ë°˜í™˜ë°›ì•˜ë‹¤. í•˜ì§€ë§Œ ë‘ë²ˆì§¸ ì¿¼ë¦¬ë¥¼ ë‚ ë¦¬ê¸° ì „ì— ì‚¬ìš©ì Aê°€ ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ì¶”ê°€í•˜ëŠ” ë™ì‘ì´ ìˆì—ˆê³  ê·¸ ê²°ê³¼ ì‚¬ìš©ì Bì—ì„œ `SELECT FOR UPDATE` ì¿¼ë¦¬ì˜ ê²°ê³¼ëŠ” 2ê°œì˜ ë°ì´í„°ë¥¼ ë°˜í™˜ë°›ê²Œ ë˜ì—ˆë‹¤. ì¦‰, Phantom Readê°€ ë°œìƒí•œ ê²ƒì´ë‹¤.

> ğŸ¤”Â REPEATABLE READì—ì„œ ì¼ë°˜ì ì¸ `SELECT` ì ˆì˜ ê²½ìš° í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ì—ì„œëŠ” ê°™ì€ ê²°ê³¼ê°’ì„ ë°˜í™˜í•œë‹¤ê³  í•˜ì˜€ëŠ”ë° ì–´ì§¸ì„œ ì´ëŸ¬í•œ ì¼ì´ ë°œìƒí•œ ê²ƒì¼ê¹Œ??  `SELECT~ FOR UPDATE` ë˜ëŠ” `SELECT ~ LOCK IN SHARE MODE`ë¡œ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ëŠ” ê²½ìš° SELECTí•˜ëŠ” ë°ì´í„°ì— ì“°ê¸° ì ê¸ˆì„ ê±¸ì–´ì•¼ í•˜ëŠ”ë° ì–¸ë‘ ë°ì´í„°ì—ëŠ” ì ê¸ˆì„ ê±¸ ìˆ˜ ì—†ë‹¤. ê·¸ ê²°ê³¼ í•´ë‹¹ ì¿¼ë¦¬ë“¤ì€ ì–¸ë‘ ì˜ì—­ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ê²ƒì´ ì•„ë‹Œ í˜„ì¬ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê²Œ ë˜ì–´ ì•„ë˜ì™€ ê°™ì´ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ê¸°ì¡´ì— ì¡´ì¬í•˜ì§€ ì•Šë˜ ìƒˆë¡œìš´ ë°ì´í„°ê°€ ì¡°íšŒë˜ëŠ” Phantom Readí˜„ìƒì´ ë°œìƒí•˜ê²Œ ëœë‹¤.
>

> ğŸ“ŒÂ REPEATABLE READì€ MySQLì˜ InnoDB ìŠ¤í† ë¦¬ì§€ ì—”ì§„ì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ê²©ë¦¬ ìˆ˜ì¤€ì´ë‹¤.
>

> InnoDBëŠ” ë„¥ìŠ¤íŠ¸ í‚¤ ë½ ë•ë¶„ì— REPEATABLE READì—ì„œë„ Phantom Readê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.
>

### InnoDBì˜ REPEATABLE READì—ì„œ Phantom Readê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ” ì´ìœ 

InnoDB ìŠ¤í† ë¦¬ì§€ ì—”ì§„ì—ì„œëŠ” **ë ˆì½”ë“œ ë½** ë¿ë§Œ ì•„ë‹ˆë¼ ë ˆì½”ë“œì™€ ë ˆì½”ë“œ ì‚¬ì´ì˜ ê°„ê²©ì„ ì¡ê·¸ëŠ” **ê°­(GAP)ë½**ì´ ì¡´ì¬í•œë‹¤.

> **ë ˆì½”ë“œ(Record) ë½**ì´ë€?
>
> - ë ˆì½”ë“œ ë½ì´ë€ ë ˆì½”ë“œ ìì²´ë§Œì„ ì ê·¸ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤. InnoDB ìŠ¤í† ë¦¬ì§€ ì—”ì§„ì€ ë ˆì½”ë“œ ìì²´ê°€ ì•„ë‹ˆë¼ ì¸ë±ìŠ¤ì˜ ë ˆì½”ë“œë¥¼ ì ê·¸ëŠ” ë°©ì‹ìœ¼ë¡œ ë™ì‘í•œë‹¤.

> **ê°­(GAP) ë½**ì´ë€?
>
> - ê°­ ë½ì€ ë ˆì½”ë“œ ìì²´ê°€ ì•„ë‹ˆë¼ ë ˆì½”ë“œì™€ ë°”ë¡œ ì¸ì ‘í•œ ë ˆì½”ë“œ ì‚¬ì´ì˜ ê°„ê²©ì„ ì ê·¸ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤. ê°­ ë½ì˜ ì—­í• ì€ ë ˆì½”ë“œì™€ ë ˆì½”ë“œ ì‚¬ì´ì˜ ê°„ê²©ì— ìƒˆë¡œìš´ ë ˆì½”ë“œê°€ ìƒì„±ë˜ëŠ” ê²ƒì„ ì œì–´í•œë‹¤.

ì´ëŸ¬í•œ ë ˆì½”ë“œ ë½ê³¼ ê°­ ë½ì„ í•©ì³ ë†“ì€ í˜•íƒœë¥¼ ë„¥ìŠ¤íŠ¸ í‚¤ ë½ì´ë¼ê³  í•œë‹¤. ê·¸ëŸ¼ **ë„¥ìŠ¤íŠ¸ í‚¤ ë½(Next key lock)**ì´ ì–´ë–»ê²Œ ë™ì‘í•˜ê¸¸ë˜ Phantom Readê°€ ë°œìƒí•˜ì§€ ì•Šì„ê¹Œ?

ì˜ˆì‹œë¥¼ ë“¤ì–´ë³´ë©´ groupsí…Œì´ë¸”ì— PKê°€ 12, 15ì¸ ë°ì´í„°ê°€ ìˆë‹¤ê³  ê°€ì •í•´ë³´ê² ë‹¤. ì´ë•Œ `SELECT * FROM groups WHERE id BETWEEN 10 AND 20 FOR UPDATE` ì¿¼ë¦¬ê°€ ì‹¤í–‰ëœë‹¤ë©´ idê°€ 12, 15ì¸ ë°ì´í„°ëŠ” ë ˆì½”ë“œ ë½ì´ ê±¸ë¦¬ê²Œ ëœë‹¤. ê·¸ë¦¬ê³  10 â‰¤ id â‰¤ 11, 13 â‰¤ id â‰¤ 14, 16 â‰¤ id â‰¤ 20ì¸ idì— ëŒ€í•´ì„œëŠ” ê°­ë½ì´ ê±¸ë¦¬ê²Œ ëœë‹¤. ì¦‰, ë‘ ê°€ì§€ ë½ì´ ê±¸ë ¤ ì§€ì •ëœ ë²”ìœ„ëŠ” ëª¨ë‘ ë½ì´ ê±¸ë¦¬ê²Œ ëœë‹¤.

ì´ëŸ¬í•œ ë°©ì‹ì„ í†µí•´ InnoDB ìŠ¤í† ë¦¬ì§€ ì—”ì§„ì€ ë„¥ìŠ¤íŠ¸ í‚¤ ë½ì„ í†µí•´ REPEATABLE READì—ì„œë„ Phantom Readê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.

# Level 3. SERIALIZABLE

SERIALIZABLEì€ í•œ íŠ¸ëœì­ì…˜ì—ì„œ ì½ê¸°, ì“°ê¸° ë“±ì˜ ëª¨ë“  ë°ì´í„°ë“¤ì€ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ ì ‘ê·¼í•  ìˆ˜ ì—†ê²Œ í•œë‹¤. ëª¨ë“  ë™ì‘ì´ ì§ë ¬í™”í•˜ê²Œ ì‘ë™í•˜ì—¬ ì™„ë²½í•œ ì½ê¸° ì¼ê´€ì„± ëª¨ë“œë¥¼ ì œê³µí•œë‹¤. ë°ì´í„°ì— ì ‘ê·¼í•˜ëŠ” ê²ƒ ë§Œìœ¼ë¡œë„ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì€ í•´ë‹¹ ë°ì´í„°ì— ì ‘ê·¼í•  ìˆ˜ ì—†ê¸°ì— REPEATABLE READì—ì„œ ë°œìƒí•˜ëŠ” Phantom ReadëŠ” ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.

í•´ë‹¹ ê²©ë¦¬ ìˆ˜ì¤€ì€ ê°€ì¥ ë‹¨ìˆœí•˜ë©´ì„œ ì—„ê²©í•œ ê²©ë¦¬ ìˆ˜ì¤€ìœ¼ë¡œ, í•œ íŠ¸ëœì­ì…˜ì—ì„œ ì ‘ê·¼í•œ ë°ì´í„°ëŠ” í•­ìƒ lockì„ ê±¸ê²Œ ë˜ì–´ ë™ì‹œ ì²˜ë¦¬ ì„±ëŠ¥ì´ ë‹¤ë¥¸ ê²©ë¦¬ìˆ˜ì¤€ë³´ë‹¤ ë–¨ì–´ì§€ëŠ” í¸ì´ë‹¤. ê·¸ë˜ì„œ ë°ì´í„°ì˜ ì•ˆì •ì„±ì´ ë§¤ìš° ì¤‘ìš”í•œ íŠ¹ìˆ˜í•œ ìƒí™©ì´ ì•„ë‹ˆë©´ ê±°ì˜ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” í¸ì´ë‹¤.

# ë§ˆì¹˜ë©°

ì˜¤ëŠ˜ì€ íŠ¸ëœì­ì…˜ì˜ ê²©ë¦¬ ìˆ˜ì¤€ì— ëŒ€í•´ í•™ìŠµí•´ë´¤ë‹¤. íŠ¸ëœì­ì…˜ ê°„ì˜ ì¼ê´€ì„±ì´ 100% ê°™ìœ¼ë©´ ì¢‹ê¸´ í•˜ë‚˜ ëª¨ë“  íŠ¸ëœì­ì…˜ê°„ì˜ ì¼ê´€ì„±ì„ ë§ì¶”ë ¤ë©´ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ì´ DBì— ì ‘ê·¼í•  ë•Œ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ ì ‘ê·¼í•˜ì§€ ëª»í•˜ë„ë¡ Lockì„ ê±¸ì–´ë‘¬ì•¼ í•˜ì—¬ ì„±ëŠ¥ìƒì˜ ì†í•´ë¥¼ ë³´ê²Œ ëœë‹¤.

ê²©ë¦¬ ìˆ˜ì¤€ì˜ ê²½ìš° ë°ì´í„°ì˜ ë¶€ì •í•©, ì„±ëŠ¥ì˜ í° ì˜í–¥ì„ ì£¼ëŠ” ì„¤ì •ì´ê¸°ì— ìƒí™©ì— ë§ëŠ” ì ì ˆí•œ ê²©ë¦¬ ìˆ˜ì¤€ì„ ì„¤ì •í•˜ì—¬ì•¼ í•œë‹¤.

> ìµœê·¼ êµ¬êµ¬ì™€ ì˜¤ë¦¬ê°€ ë°ì´í„°ë² ì´ìŠ¤ Lockì— ëŒ€í•´ ì´ì•¼ê¸°í•˜ëŠ” ê²ƒì„ ë“¤ì—ˆëŠ”ë°, êµ¬êµ¬ê°€ ë§í•˜ê¸¸ ì‹¤ë¬´ì—ì„œëŠ” ë°ì´í„°ë² ì´ìŠ¤ Lockì€ ì„±ëŠ¥ìƒì˜ ì €í•˜ë¥¼ ë°œìƒì‹œì¼œ ê±¸ì§€ ì•ŠëŠ”í¸ì´ë¼ê³  í•˜ì…¨ë‹¤.
>

# ğŸ“šÂ Reference
- [Real MySQL 8.0 (1ê¶Œ)](https://search.shopping.naver.com/book/catalog/32443973624?cat_id=50010586&frm=PBOKPRO&query=Real+MySQL&NaPm=ct%3Dl9jmw3ww%7Cci%3D919378d99905f247dd892d6e762d6de24fc0090e%7Ctr%3Dboknx%7Csn%3D95694%7Chk%3D947baef41da176108f3c36f2fb35dfd629b8f698)
- [[ë°ì´í„°ë² ì´ìŠ¤] MySQL íŠ¸ëœì­ì…˜ ê²©ë¦¬ ìˆ˜ì¤€](https://steady-coding.tistory.com/562)
