<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0"/><style data-href="/styles.d53766664f3eaba3db40.css" id="gatsby-global-css">/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}button{background-color:transparent;background-image:none}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}html{font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5}*,:after,:before{box-sizing:border-box;border:0 solid #e2e8f0}hr{border-top-width:1px}img{border-style:solid}textarea{resize:vertical}input::-webkit-input-placeholder,textarea::-webkit-input-placeholder{color:#a0aec0}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#a0aec0}input::placeholder,textarea::placeholder{color:#a0aec0}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit}code,kbd,pre,samp{font-family:Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}</style><meta name="generator" content="Gatsby 2.32.13"/><style type="text/css">
    .toc-header.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .toc-header.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .toc-header svg,
    h2 .toc-header svg,
    h3 .toc-header svg,
    h4 .toc-header svg,
    h5 .toc-header svg,
    h6 .toc-header svg {
      visibility: hidden;
    }
    h1:hover .toc-header svg,
    h2:hover .toc-header svg,
    h3:hover .toc-header svg,
    h4:hover .toc-header svg,
    h5:hover .toc-header svg,
    h6:hover .toc-header svg,
    h1 .toc-header:focus svg,
    h2 .toc-header:focus svg,
    h3 .toc-header:focus svg,
    h4 .toc-header:focus svg,
    h5 .toc-header:focus svg,
    h6 .toc-header:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link rel="icon" href="/favicon-32x32-219f5f1c2ff5084c4162c59e17deafcf.png" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#3F4145"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48-219f5f1c2ff5084c4162c59e17deafcf.png"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72-219f5f1c2ff5084c4162c59e17deafcf.png"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96-219f5f1c2ff5084c4162c59e17deafcf.png"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144-219f5f1c2ff5084c4162c59e17deafcf.png"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192-219f5f1c2ff5084c4162c59e17deafcf.png"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256-219f5f1c2ff5084c4162c59e17deafcf.png"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384-219f5f1c2ff5084c4162c59e17deafcf.png"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512-219f5f1c2ff5084c4162c59e17deafcf.png"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><title data-react-helmet="true">모두모여라 팀의 동시성 문제 해결 과정 (feat. Redis, 분산락) | Seongwon.dev</title><meta data-react-helmet="true" name="description" content="이번 게시글은 모임 플랫폼인 모두모여라 프로젝트를 진행하며 동시성 문제를 해결한 과정에 대해 정리한 게시글입니다. 단일 서버에서 간단하게 해결한 방법으로부터 최종적으로 분산락을 적용한 과정까지 전 과정을 정리하였습니다. (앞의 과정은 간단히 설명하고 최종 적용한 분산락에 대해 자세히 설명하려 합니다.) 모두모여라 서비스의 모임 참여 기능은 모임 별로 주최…"/><meta data-react-helmet="true" property="og:title" content="모두모여라 팀의 동시성 문제 해결 과정 (feat. Redis, 분산락)"/><meta data-react-helmet="true" property="og:image" content="/static/social-image-8338e9c490d69efea769113e3720a1ec.png"/><meta data-react-helmet="true" property="og:description" content="이번 게시글은 모임 플랫폼인 모두모여라 프로젝트를 진행하며 동시성 문제를 해결한 과정에 대해 정리한 게시글입니다. 단일 서버에서 간단하게 해결한 방법으로부터 최종적으로 분산락을 적용한 과정까지 전 과정을 정리하였습니다. (앞의 과정은 간단히 설명하고 최종 적용한 분산락에 대해 자세히 설명하려 합니다.) 모두모여라 서비스의 모임 참여 기능은 모임 별로 주최…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:image" content="/static/social-image-8338e9c490d69efea769113e3720a1ec.png"/><meta data-react-helmet="true" name="twitter:creator" content="Seongwon"/><meta data-react-helmet="true" name="twitter:title" content="모두모여라 팀의 동시성 문제 해결 과정 (feat. Redis, 분산락)"/><meta data-react-helmet="true" name="twitter:description" content="이번 게시글은 모임 플랫폼인 모두모여라 프로젝트를 진행하며 동시성 문제를 해결한 과정에 대해 정리한 게시글입니다. 단일 서버에서 간단하게 해결한 방법으로부터 최종적으로 분산락을 적용한 과정까지 전 과정을 정리하였습니다. (앞의 과정은 간단히 설명하고 최종 적용한 분산락에 대해 자세히 설명하려 합니다.) 모두모여라 서비스의 모임 참여 기능은 모임 별로 주최…"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link as="script" rel="preload" href="/webpack-runtime-2da3c169fb26441916c3.js"/><link as="script" rel="preload" href="/framework-eb684e3e828ad13b3940.js"/><link as="script" rel="preload" href="/styles-84a9bc99193fe5828ffe.js"/><link as="script" rel="preload" href="/dc6a8720040df98778fe970bf6c000a41750d3ae-17eb047fb821ccbad0b0.js"/><link as="script" rel="preload" href="/app-dafb8249d5df2d36e2cc.js"/><link as="script" rel="preload" href="/d7eeaac4-dcbe97e7a5aa158c9d08.js"/><link as="script" rel="preload" href="/5e2a4920-da90abce4a08c86a094c.js"/><link as="script" rel="preload" href="/1bfc9850-409296e666dade882413.js"/><link as="script" rel="preload" href="/commons-d4794f4d9e0af84805d6.js"/><link as="script" rel="preload" href="/7a297f752dcfe258c0b0106d89edb3a916af916e-35686b2093ef54ff3248.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-c13fb2d53b7ec5e4b38f.js"/><link as="fetch" rel="preload" href="/page-data/Spring-MVC/20230528-모두모여라_팀의_동시성문제_해결_과정/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3911196313.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/4111100897.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><noscript><style data-emotion-css="18dual">.css-18dual{position:fixed;bottom:0;left:0;margin-left:0.5rem;margin-bottom:0.5rem;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;box-shadow:0 1px 3px 0 rgba(0,0,0,0.1),0 1px 2px 0 rgba(0,0,0,0.06);-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border-radius:0.25rem;--text-opacity:1;color:rgba(255,255,255,var(--text-opacity));font-size:0.875rem;font-weight:700;padding-left:1rem;padding-right:1rem;padding-top:0.75rem;padding-bottom:0.75rem;background-color:#c6cefc;z-index:9999;}</style><div class="css-18dual"><style data-emotion-css="5x4yj0">.css-5x4yj0{fill:currentColor;width:1.5rem;height:1.5rem;margin-right:0.5rem;}</style><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 192 512" class="css-5x4yj0" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M20 424.229h20V279.771H20c-11.046 0-20-8.954-20-20V212c0-11.046 8.954-20 20-20h112c11.046 0 20 8.954 20 20v212.229h20c11.046 0 20 8.954 20 20V492c0 11.046-8.954 20-20 20H20c-11.046 0-20-8.954-20-20v-47.771c0-11.046 8.954-20 20-20zM96 0C56.235 0 24 32.235 24 72s32.235 72 72 72 72-32.235 72-72S135.764 0 96 0z"></path></svg><style data-emotion-css="1f2k2gl">.css-1f2k2gl{margin-left:0.5rem;}</style><div class="css-1f2k2gl">Please enable JavaScript to use this site.<br/>JavaScript를 활성화 시켜주세요.</div></div></noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion-css="f6s0ma">.css-f6s0ma{-webkit-transition:all 300ms cubic-bezier(0.4,0,0.2,1);transition:all 300ms cubic-bezier(0.4,0,0.2,1);background-color:#FFFFFF;color:#333333;}</style><style data-emotion-css="acifd">.css-acifd{min-height:100vh;-webkit-transition:all 300ms cubic-bezier(0.4,0,0.2,1);transition:all 300ms cubic-bezier(0.4,0,0.2,1);background-color:#FFFFFF;color:#333333;}</style><div class="css-acifd e1r7j5660"><style data-emotion-css="8ezs2g">.css-8ezs2g{min-height:calc(100vh - 100px);}</style><div class="css-8ezs2g"><style data-emotion-css="evzedb">.css-evzedb{background:linear-gradient( 90deg,#434cf5,#c6cefc );}</style><div class="css-evzedb"><style data-emotion-css="1mqm4zt">.css-1mqm4zt{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;max-width:1280px;margin-left:auto;margin-right:auto;padding:1.25rem;}</style><nav class="css-1mqm4zt esdsp220"><style data-emotion-css="1usmgm5">.css-1usmgm5{font-size:1.25rem;--text-opacity:1;color:rgba(255,255,255,var(--text-opacity));font-weight:700;}</style><a class="css-1usmgm5" href="/">Seongwon.dev</a><a aria-label="search page" href="/search"><style data-emotion-css="47445j">.css-47445j{--text-opacity:1;color:rgba(255,255,255,var(--text-opacity));margin-top:auto;margin-bottom:auto;width:2rem;height:2rem;}</style><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="css-47445j" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0 0 11.6 0l43.6-43.5a8.2 8.2 0 0 0 0-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"></path></svg></a></nav></div><style data-emotion-css="16kfbrf">.css-16kfbrf{background:linear-gradient( 90deg,#434cf5,#c6cefc );position:fixed;width:100%;box-shadow:0 1px 3px 0 rgba(0,0,0,0.1),0 1px 2px 0 rgba(0,0,0,0.06);z-index:100;-webkit-transition:all 300ms cubic-bezier(0,0,0.2,1);transition:all 300ms cubic-bezier(0,0,0.2,1);top:-100px;}</style><div class="css-16kfbrf"><nav class="css-1mqm4zt esdsp220"><a class="css-1usmgm5" href="/">Seongwon.dev</a><a aria-label="search page" href="/search"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="css-47445j" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0 0 11.6 0l43.6-43.5a8.2 8.2 0 0 0 0-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"></path></svg></a></nav></div><style data-emotion-css="w27u98">.css-w27u98{margin-top:1rem;padding-left:1rem;padding-right:1rem;}</style><div class="blog-post-container css-w27u98"><div class="blog-post"><style data-emotion-css="1bdwg0l">.css-1bdwg0l{width:100%;max-width:768px;margin-left:auto;margin-right:auto;}</style><div class="css-1bdwg0l etadk2t0"><style data-emotion-css="1abxlfd">.css-1abxlfd{font-size:2.25rem;font-weight:700;margin-bottom:1rem;}@media (min-width:768px){.css-1abxlfd{font-size:3rem;}}</style><h1 class="blog-title css-1abxlfd">모두모여라 팀의 동시성 문제 해결 과정 (feat. Redis, 분산락)</h1><style data-emotion-css="cpn9zx">.css-cpn9zx{font-size:1rem;margin-bottom:1rem;}</style><h2 class="blog-date css-cpn9zx">2023년 05월 28일</h2><style data-emotion-css="cet0rr">.css-cet0rr{margin-bottom:0.5rem;}</style><div class="blog-tags css-cet0rr"><style data-emotion-css="1ak4bcm">.css-1ak4bcm{white-space:nowrap;-webkit-transition:all 300ms cubic-bezier(0.4,0,0.2,1);transition:all 300ms cubic-bezier(0.4,0,0.2,1);font-size:1rem;font-weight:700;border-radius:9999px;margin-right:0.5rem;margin-top:0.25rem;margin-bottom:0.25rem;padding-top:0.25rem;padding-bottom:0.25rem;padding-left:0.75rem;padding-right:0.75rem;background-color:#edf2f7;color:#3737B9;}</style><button class="css-1ak4bcm">SpringFramework</button><button class="css-1ak4bcm">JPA</button><button class="css-1ak4bcm">synchronized</button><button class="css-1ak4bcm">비관적락</button><button class="css-1ak4bcm">Pessimistic Lock</button><button class="css-1ak4bcm">낙관적락</button><button class="css-1ak4bcm">Optimistic Lock</button><button class="css-1ak4bcm">Redis</button><button class="css-1ak4bcm">분산락</button><button class="css-1ak4bcm">Reddisson</button></div><style data-emotion-css="1l4w6pd">.css-1l4w6pd{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}</style><div class="css-1l4w6pd"><style data-emotion-css="1i57it9">.css-1i57it9{border-radius:9999px;width:100%;height:1px;--bg-opacity:1;background-color:rgba(247,250,252,var(--bg-opacity));background:linear-gradient( 270deg,#434cf5,#c6cefc,#91eac9 );}</style><div class="css-1i57it9"></div></div></div><div class="blog-content"><style data-emotion-css="taxs14">.css-taxs14{-webkit-scrollbar-width:thin;-moz-scrollbar-width:thin;-ms-scrollbar-width:thin;scrollbar-width:thin;-webkit-scrollbar-color:gray transparent;-moz-scrollbar-color:gray transparent;-ms-scrollbar-color:gray transparent;scrollbar-color:gray transparent;display:none;}.css-taxs14::-webkit-scrollbar{width:4px;}.css-taxs14::-webkit-scrollbar-track{background-color:transparent;}.css-taxs14::-webkit-scrollbar-thumb{border-radius:9999px;background-color:gray;}.css-taxs14::-webkit-scrollbar-button{width:0;height:0;}@media screen and (min-width:1280px){.css-taxs14{float:right;position:-webkit-sticky;position:sticky;top:100px;width:calc((100vw - 720px) / 2 - 80px);max-width:250px;margin-right:1rem;overflow:auto;word-break:break-word;max-height:calc(100vh - 200px);fontsize:1rem;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;border-left-width:4px;border-image:linear-gradient( 180deg,#434cf5,#c6cefc,#91eac9 );border-image-slice:1;}}</style><div class="css-taxs14"><style data-emotion-css="13af3fo">.css-13af3fo{margin-left:1rem;margin-right:1rem;}</style><div class="css-13af3fo"><style data-emotion-css="17i5xbf">.css-17i5xbf{font-weight:700;margin-bottom:0.5rem;font-size:1.125rem;--text-opacity:1;color:rgba(74,85,104,var(--text-opacity));}</style><h3 class="css-17i5xbf">TOC</h3><style data-emotion-css="1me4zjn">.css-1me4zjn ul{margin-left:0.5rem;}.css-1me4zjn ul > li a:hover{color:#555555;}.css-1me4zjn ul > li a{-webkit-transition:all 300ms cubic-bezier(0.4,0,0.2,1);transition:all 300ms cubic-bezier(0.4,0,0.2,1);--text-opacity:1;color:rgba(160,174,192,var(--text-opacity));font-size:0.875rem;}.css-1me4zjn ul > li a[href=""]{font-size:0.95rem;color:#555555;}</style><div class="css-1me4zjn"><ul>
<li>
<p><a href="/Spring-MVC/20230528-%EB%AA%A8%EB%91%90%EB%AA%A8%EC%97%AC%EB%9D%BC_%ED%8C%80%EC%9D%98_%EB%8F%99%EC%8B%9C%EC%84%B1%EB%AC%B8%EC%A0%9C_%ED%95%B4%EA%B2%B0_%EA%B3%BC%EC%A0%95/#%ED%95%B4%EA%B2%B0-%EA%B3%BC%EC%A0%95-1---synchronized">해결 과정 1 - synchronized</a></p>
<ul>
<li><a href="/Spring-MVC/20230528-%EB%AA%A8%EB%91%90%EB%AA%A8%EC%97%AC%EB%9D%BC_%ED%8C%80%EC%9D%98_%EB%8F%99%EC%8B%9C%EC%84%B1%EB%AC%B8%EC%A0%9C_%ED%95%B4%EA%B2%B0_%EA%B3%BC%EC%A0%95/#%EC%BD%94%EB%93%9C-%EB%B0%8F-%EA%B2%B0%EA%B3%BC">코드 및 결과</a></li>
<li><a href="/Spring-MVC/20230528-%EB%AA%A8%EB%91%90%EB%AA%A8%EC%97%AC%EB%9D%BC_%ED%8C%80%EC%9D%98_%EB%8F%99%EC%8B%9C%EC%84%B1%EB%AC%B8%EC%A0%9C_%ED%95%B4%EA%B2%B0_%EA%B3%BC%EC%A0%95/#%EB%82%A8%EC%95%84%EC%9E%88%EB%8A%94-%EB%AC%B8%EC%A0%9C">남아있는 문제</a></li>
</ul>
</li>
<li>
<p><a href="/Spring-MVC/20230528-%EB%AA%A8%EB%91%90%EB%AA%A8%EC%97%AC%EB%9D%BC_%ED%8C%80%EC%9D%98_%EB%8F%99%EC%8B%9C%EC%84%B1%EB%AC%B8%EC%A0%9C_%ED%95%B4%EA%B2%B0_%EA%B3%BC%EC%A0%95/#%ED%95%B4%EA%B2%B0-%EA%B3%BC%EC%A0%95-2---%EB%B9%84%EA%B4%80%EC%A0%81-%EB%9D%BD-vs-%EB%82%99%EA%B4%80%EC%A0%81-%EB%9D%BD">해결 과정 2 - 비관적 락 vs 낙관적 락</a></p>
<ul>
<li><a href="/Spring-MVC/20230528-%EB%AA%A8%EB%91%90%EB%AA%A8%EC%97%AC%EB%9D%BC_%ED%8C%80%EC%9D%98_%EB%8F%99%EC%8B%9C%EC%84%B1%EB%AC%B8%EC%A0%9C_%ED%95%B4%EA%B2%B0_%EA%B3%BC%EC%A0%95/#%EC%BD%94%EB%93%9C-%EB%B0%8F-%EA%B2%B0%EA%B3%BC-1">코드 및 결과</a></li>
<li><a href="/Spring-MVC/20230528-%EB%AA%A8%EB%91%90%EB%AA%A8%EC%97%AC%EB%9D%BC_%ED%8C%80%EC%9D%98_%EB%8F%99%EC%8B%9C%EC%84%B1%EB%AC%B8%EC%A0%9C_%ED%95%B4%EA%B2%B0_%EA%B3%BC%EC%A0%95/#%EB%82%A8%EC%95%84%EC%9E%88%EB%8A%94-%EB%AC%B8%EC%A0%9C-1">남아있는 문제</a></li>
</ul>
</li>
<li>
<p><a href="/Spring-MVC/20230528-%EB%AA%A8%EB%91%90%EB%AA%A8%EC%97%AC%EB%9D%BC_%ED%8C%80%EC%9D%98_%EB%8F%99%EC%8B%9C%EC%84%B1%EB%AC%B8%EC%A0%9C_%ED%95%B4%EA%B2%B0_%EA%B3%BC%EC%A0%95/#%ED%95%B4%EA%B2%B0-%EA%B3%BC%EC%A0%95-3---redis-%EB%B6%84%EC%82%B0%EB%9D%BD">해결 과정 3 - Redis 분산락</a></p>
<ul>
<li>
<p><a href="/Spring-MVC/20230528-%EB%AA%A8%EB%91%90%EB%AA%A8%EC%97%AC%EB%9D%BC_%ED%8C%80%EC%9D%98_%EB%8F%99%EC%8B%9C%EC%84%B1%EB%AC%B8%EC%A0%9C_%ED%95%B4%EA%B2%B0_%EA%B3%BC%EC%A0%95/#%EC%82%AC%EC%9A%A9-%EA%B8%B0%EC%88%A0-%EC%84%A0%EC%A0%95">사용 기술 선정</a></p>
<ul>
<li><a href="/Spring-MVC/20230528-%EB%AA%A8%EB%91%90%EB%AA%A8%EC%97%AC%EB%9D%BC_%ED%8C%80%EC%9D%98_%EB%8F%99%EC%8B%9C%EC%84%B1%EB%AC%B8%EC%A0%9C_%ED%95%B4%EA%B2%B0_%EA%B3%BC%EC%A0%95/#lettuce-vs-redisson">Lettuce vs Redisson</a></li>
</ul>
</li>
<li>
<p><a href="/Spring-MVC/20230528-%EB%AA%A8%EB%91%90%EB%AA%A8%EC%97%AC%EB%9D%BC_%ED%8C%80%EC%9D%98_%EB%8F%99%EC%8B%9C%EC%84%B1%EB%AC%B8%EC%A0%9C_%ED%95%B4%EA%B2%B0_%EA%B3%BC%EC%A0%95/#%EB%B6%84%EC%82%B0%EB%9D%BD-%EC%A0%81%EC%9A%A9">분산락 적용</a></p>
<ul>
<li><a href="/Spring-MVC/20230528-%EB%AA%A8%EB%91%90%EB%AA%A8%EC%97%AC%EB%9D%BC_%ED%8C%80%EC%9D%98_%EB%8F%99%EC%8B%9C%EC%84%B1%EB%AC%B8%EC%A0%9C_%ED%95%B4%EA%B2%B0_%EA%B3%BC%EC%A0%95/#%EC%9D%98%EC%A1%B4%EC%84%B1-%EC%B6%94%EA%B0%80">의존성 추가</a></li>
<li><a href="/Spring-MVC/20230528-%EB%AA%A8%EB%91%90%EB%AA%A8%EC%97%AC%EB%9D%BC_%ED%8C%80%EC%9D%98_%EB%8F%99%EC%8B%9C%EC%84%B1%EB%AC%B8%EC%A0%9C_%ED%95%B4%EA%B2%B0_%EA%B3%BC%EC%A0%95/#distributionlockjava">DistributionLock.java</a></li>
<li><a href="/Spring-MVC/20230528-%EB%AA%A8%EB%91%90%EB%AA%A8%EC%97%AC%EB%9D%BC_%ED%8C%80%EC%9D%98_%EB%8F%99%EC%8B%9C%EC%84%B1%EB%AC%B8%EC%A0%9C_%ED%95%B4%EA%B2%B0_%EA%B3%BC%EC%A0%95/#distributionlockkeygeneratorjava">DistributionLockKeyGenerator.java</a></li>
<li><a href="/Spring-MVC/20230528-%EB%AA%A8%EB%91%90%EB%AA%A8%EC%97%AC%EB%9D%BC_%ED%8C%80%EC%9D%98_%EB%8F%99%EC%8B%9C%EC%84%B1%EB%AC%B8%EC%A0%9C_%ED%95%B4%EA%B2%B0_%EA%B3%BC%EC%A0%95/#distributionlockaopjava">DistributionLockAop.java</a></li>
<li><a href="/Spring-MVC/20230528-%EB%AA%A8%EB%91%90%EB%AA%A8%EC%97%AC%EB%9D%BC_%ED%8C%80%EC%9D%98_%EB%8F%99%EC%8B%9C%EC%84%B1%EB%AC%B8%EC%A0%9C_%ED%95%B4%EA%B2%B0_%EA%B3%BC%EC%A0%95/#transactiongeneratoraopjava">TransactionGeneratorAop.java</a></li>
<li><a href="/Spring-MVC/20230528-%EB%AA%A8%EB%91%90%EB%AA%A8%EC%97%AC%EB%9D%BC_%ED%8C%80%EC%9D%98_%EB%8F%99%EC%8B%9C%EC%84%B1%EB%AC%B8%EC%A0%9C_%ED%95%B4%EA%B2%B0_%EA%B3%BC%EC%A0%95/#%EB%B9%84%EC%A6%88%EB%8B%88%EC%8A%A4-%EB%A1%9C%EC%A7%81">비즈니스 로직</a></li>
<li><a href="/Spring-MVC/20230528-%EB%AA%A8%EB%91%90%EB%AA%A8%EC%97%AC%EB%9D%BC_%ED%8C%80%EC%9D%98_%EB%8F%99%EC%8B%9C%EC%84%B1%EB%AC%B8%EC%A0%9C_%ED%95%B4%EA%B2%B0_%EA%B3%BC%EC%A0%95/#%EA%B2%B0%EA%B3%BC-%ED%99%95%EC%9D%B8">결과 확인</a></li>
</ul>
</li>
<li>
<p><a href="/Spring-MVC/20230528-%EB%AA%A8%EB%91%90%EB%AA%A8%EC%97%AC%EB%9D%BC_%ED%8C%80%EC%9D%98_%EB%8F%99%EC%8B%9C%EC%84%B1%EB%AC%B8%EC%A0%9C_%ED%95%B4%EA%B2%B0_%EA%B3%BC%EC%A0%95/#%EB%B0%9C%EC%83%9D%ED%95%9C-%EB%AC%B8%EC%A0%9C">발생한 문제</a></p>
<ul>
<li><a href="/Spring-MVC/20230528-%EB%AA%A8%EB%91%90%EB%AA%A8%EC%97%AC%EB%9D%BC_%ED%8C%80%EC%9D%98_%EB%8F%99%EC%8B%9C%EC%84%B1%EB%AC%B8%EC%A0%9C_%ED%95%B4%EA%B2%B0_%EA%B3%BC%EC%A0%95/#%EB%AC%B8%EC%A0%9C---%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98%EC%9D%84-%EC%83%88%EB%A1%9C-%EB%B6%84%EB%A6%AC%ED%95%98%EB%A9%B0-%EC%8B%A4%ED%8C%A8%ED%95%98%EB%8A%94-%ED%85%8C%EC%8A%A4%ED%8A%B8">문제 - 트랜잭션을 새로 분리하며 실패하는 테스트</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="/Spring-MVC/20230528-%EB%AA%A8%EB%91%90%EB%AA%A8%EC%97%AC%EB%9D%BC_%ED%8C%80%EC%9D%98_%EB%8F%99%EC%8B%9C%EC%84%B1%EB%AC%B8%EC%A0%9C_%ED%95%B4%EA%B2%B0_%EA%B3%BC%EC%A0%95/#reference">📚Reference</a></li>
</ul></div></div></div><div class="css-1bdwg0l etadk2t0"><div><style data-emotion-css="18ks7l0">.css-18ks7l0{font-size:1rem;word-break:break-word;}.css-18ks7l0 h1 > a > svg,.css-18ks7l0 h2 > a > svg,.css-18ks7l0 h3 > a > svg,.css-18ks7l0 h4 > a > svg,.css-18ks7l0 h5 > a > svg,.css-18ks7l0 h6 > a > svg{fill:#000;}.css-18ks7l0 h1,.css-18ks7l0 h2{font-size:1.25rem;font-weight:600;margin-top:1.5rem;margin-bottom:1.5rem;}.css-18ks7l0 h3,.css-18ks7l0 h4,.css-18ks7l0 h5,.css-18ks7l0 h6{font-size:1.125rem;margin-top:1.5rem;margin-bottom:1.5rem;font-weight:600;}@media (min-width:640px){.css-18ks7l0 h1,.css-18ks7l0 h2{font-size:1.5rem;}.css-18ks7l0 h3,.css-18ks7l0 h4,.css-18ks7l0 h5,.css-18ks7l0 h6{font-size:1.25rem;}}.css-18ks7l0 a{color:#3737B9;}.css-18ks7l0 a:hover{-webkit-text-decoration:underline;text-decoration:underline;}.css-18ks7l0 p{margin:0.3rem;margin-top:0.75rem;margin-bottom:0.75rem;}.css-18ks7l0 ul,.css-18ks7l0 ol{margin:0.3rem;margin-left:2rem;}.css-18ks7l0 li > p,.css-18ks7l0 li > ul,.css-18ks7l0 li > ol{margin-bottom:0;}.css-18ks7l0 ol{list-style-type:decimal;}.css-18ks7l0 ul{list-style-type:disc;}.css-18ks7l0 blockquote{padding:0.5rem;background-color:#eee;margin:0.3rem;margin-top:0.5rem;margin-bottom:0.5rem;border-left-width:4px;border-color:#c6cefc;}.css-18ks7l0 blockquote > p{margin:0.5rem;}.css-18ks7l0 blockquote > h1,.css-18ks7l0 blockquote > h2,.css-18ks7l0 blockquote > h3,.css-18ks7l0 blockquote > h4,.css-18ks7l0 blockquote > h5{margin-top:0.5rem;margin-bottom:0.5rem;}.css-18ks7l0 td,.css-18ks7l0 th{padding-left:0.5rem;padding-right:0.5rem;padding-top:0.25rem;padding-bottom:0.25rem;border-width:1px;border-color:#c6cefc;}.css-18ks7l0 tr:nth-of-type(even){background-color:#eee;}.css-18ks7l0 th{background-color:#eee;}.css-18ks7l0 table{margin-bottom:1.5rem;display:block;max-width:-webkit-fit-content;max-width:-moz-fit-content;max-width:fit-content;margin:0 auto;overflow-x:auto;white-space:nowrap;}.css-18ks7l0 p > code,.css-18ks7l0 li > code{padding-top:0.1rem;padding-bottom:0.1rem;padding-right:0.25rem;padding-left:0.25rem;border-radius:0.25rem;color:#3737B9;background-color:#eee;white-space:pre-line;}.css-18ks7l0 pre.grvsc-container{margin-top:24px;margin-bottom:24px;}.css-18ks7l0 hr{margin-top:24px;margin-bottom:24px;height:2px;border:none;background:linear-gradient( 270deg,#434cf5,#c6cefc,#91eac9 );}</style><div class="markdown css-18ks7l0"><p>이번 게시글은 모임 플랫폼인 모두모여라 프로젝트를 진행하며 동시성 문제를 해결한 과정에 대해 정리한 게시글입니다. 단일 서버에서 간단하게 해결한 방법으로부터 최종적으로 분산락을 적용한 과정까지 전 과정을 정리하였습니다. (앞의 과정은 간단히 설명하고 최종 적용한 분산락에 대해 자세히 설명하려 합니다.)</p>
<p>모두모여라 서비스의 모임 참여 기능은 모임 별로 주최자가 정한 모임의 인원 제한이 있습니다. 동시성 문제에 대한 아무런 처리가 없는 상황에서 여러 참여자가 동시에 참여 요청을 할 경우 모임의 제한 인원을 넘는 참여자가 생겨나는 문제가 발생하였습니다.</p>
<p>먼저 문제 상황을 알아보고자 기존 로직을 살펴보고 모임 참여에 대한 동시성 테스트 코드를 작성하며 테스트를 해보겠습니다. 모임 참여 로직을 살펴보면 아래와 같이 JPA를 통해 모임(Group)과 회원(Member) 정보를 데이터베이스에서 읽어온 후에 모임 참여를 진행하였습니다.</p>
<pre class="grvsc-container one-dark-pro" data-language="java" data-index="0"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">RequiredArgsConstructor</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">Transactional</span><span class="mtk4">(</span><span class="mtk7">readOnly</span><span class="mtk4"> </span><span class="mtk8">=</span><span class="mtk4"> </span><span class="mtk7">true</span><span class="mtk4">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">Service</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">public</span><span class="mtk4"> </span><span class="mtk9">class</span><span class="mtk4"> </span><span class="mtk11">ParticipateService</span><span class="mtk4"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">private</span><span class="mtk4"> </span><span class="mtk9">final</span><span class="mtk4"> </span><span class="mtk11">MemberFindService</span><span class="mtk4"> memberFindService</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">private</span><span class="mtk4"> </span><span class="mtk9">final</span><span class="mtk4"> </span><span class="mtk11">GroupFindService</span><span class="mtk4"> groupFindService</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk1">@</span><span class="mtk11">Transactional</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">public</span><span class="mtk3"> </span><span class="mtk9">void</span><span class="mtk3"> participate</span><span class="mtk1">(</span><span class="mtk11">Long</span><span class="mtk1"> </span><span class="mtk4 mtki">groupId</span><span class="mtk1">, </span><span class="mtk11">Long</span><span class="mtk1"> </span><span class="mtk4 mtki">memberId</span><span class="mtk1">)</span><span class="mtk3"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">Group</span><span class="mtk1"> </span><span class="mtk4">group</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">groupFindService</span><span class="mtk1">.</span><span class="mtk3">findGroup</span><span class="mtk1">(groupId);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">Member</span><span class="mtk1"> </span><span class="mtk4">member</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">memberFindService</span><span class="mtk1">.</span><span class="mtk3">findMember</span><span class="mtk1">(memberId);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">group</span><span class="mtk1">.</span><span class="mtk3">participate</span><span class="mtk1">(member);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>다음으로 테스트 코드입니다. 동시성 문제를 테스트하기 위해서는 동시 요청을 테스트코드로 작성해야하기에 <code>CountDownLatch</code>와 <code>ExecutorService</code>를 통해 별도의 스레드에서 참여로직이 동시에 처리되도록 하였습니다.</p>
<pre class="grvsc-container one-dark-pro" data-language="java" data-index="1"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">Sql</span><span class="mtk4">(</span><span class="mtk7">value</span><span class="mtk4"> </span><span class="mtk8">=</span><span class="mtk4"> </span><span class="mtk6">&quot;classpath:init.sql&quot;</span><span class="mtk1">,</span><span class="mtk4"> </span><span class="mtk7">executionPhase</span><span class="mtk4"> </span><span class="mtk8">=</span><span class="mtk4"> BEFORE_TEST_METHOD)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">Sql</span><span class="mtk4">(</span><span class="mtk7">value</span><span class="mtk4"> </span><span class="mtk8">=</span><span class="mtk4"> </span><span class="mtk6">&quot;classpath:truncate.sql&quot;</span><span class="mtk1">,</span><span class="mtk4"> </span><span class="mtk7">executionPhase</span><span class="mtk4"> </span><span class="mtk8">=</span><span class="mtk4"> AFTER_TEST_METHOD)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">TestConstructor</span><span class="mtk4">(</span><span class="mtk7">autowireMode</span><span class="mtk4"> </span><span class="mtk8">=</span><span class="mtk4"> </span><span class="mtk11">TestConstructor</span><span class="mtk1">.</span><span class="mtk11">AutowireMode</span><span class="mtk1">.</span><span class="mtk4">ALL)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">RequiredArgsConstructor</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">SpringBootTest</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">class</span><span class="mtk4"> </span><span class="mtk11">ParticipateServiceConcurrencyTest</span><span class="mtk4"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">private</span><span class="mtk4"> </span><span class="mtk9">final</span><span class="mtk4"> </span><span class="mtk11">ParticipateService</span><span class="mtk4"> participateService</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">private</span><span class="mtk4"> </span><span class="mtk9">final</span><span class="mtk4"> </span><span class="mtk11">GroupRepository</span><span class="mtk4"> groupRepository</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">private</span><span class="mtk4"> </span><span class="mtk9">final</span><span class="mtk4"> </span><span class="mtk11">MemberRepository</span><span class="mtk4"> memberRepository</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">private</span><span class="mtk4"> </span><span class="mtk11">Member</span><span class="mtk4"> host</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk1">@</span><span class="mtk11">BeforeEach</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">void</span><span class="mtk3"> setUp</span><span class="mtk1">()</span><span class="mtk3"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">host</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">memberRepository</span><span class="mtk1">.</span><span class="mtk3">save</span><span class="mtk1">(</span><span class="mtk11">MOMO</span><span class="mtk1">.</span><span class="mtk3">toMember</span><span class="mtk1">());</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk1">@</span><span class="mtk11">DisplayName</span><span class="mtk4">(</span><span class="mtk6">&quot;모임 참여 동시 요청이 올 경우에도 정원을 넘어선 인원이 모임에 참여할 수 없다&quot;</span><span class="mtk4">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk1">@</span><span class="mtk11">Test</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">void</span><span class="mtk3"> participateConcurrencyTest</span><span class="mtk1">()</span><span class="mtk3"> </span><span class="mtk9">throws</span><span class="mtk3"> </span><span class="mtk11">InterruptedException</span><span class="mtk3"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9">int</span><span class="mtk1"> </span><span class="mtk4">capacity</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk7">3</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9">int</span><span class="mtk1"> </span><span class="mtk4">numOfParticipants</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk7">50</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9">long</span><span class="mtk1"> </span><span class="mtk4">groupId</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">groupRepository</span><span class="mtk1">.</span><span class="mtk3">save</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk11">MOMO_STUDY</span><span class="mtk1">.</span><span class="mtk3">builder</span><span class="mtk1">()</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                        .</span><span class="mtk3">capacity</span><span class="mtk1">(capacity)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                        .</span><span class="mtk3">toGroup</span><span class="mtk1">(host)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        ).</span><span class="mtk3">getId</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">List</span><span class="mtk1">&lt;</span><span class="mtk11">Long</span><span class="mtk1">&gt; </span><span class="mtk4">participantIds</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk9">new</span><span class="mtk1"> </span><span class="mtk11">ArrayList</span><span class="mtk1">&lt;&gt;();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9">for</span><span class="mtk1"> (</span><span class="mtk9">int</span><span class="mtk1"> </span><span class="mtk4">i</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk7">0</span><span class="mtk1">; i </span><span class="mtk8">&lt;</span><span class="mtk1"> numOfParticipants; i++) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk11">Member</span><span class="mtk1"> </span><span class="mtk4">savedMember</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">memberRepository</span><span class="mtk1">.</span><span class="mtk3">save</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                    </span><span class="mtk9">new</span><span class="mtk1"> </span><span class="mtk3">Member</span><span class="mtk1">(</span><span class="mtk11">UserId</span><span class="mtk1">.</span><span class="mtk3">momo</span><span class="mtk1">(</span><span class="mtk6">&quot;user&quot;</span><span class="mtk1"> </span><span class="mtk8">+</span><span class="mtk1"> i),</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                            </span><span class="mtk11">Password</span><span class="mtk1">.</span><span class="mtk3">encrypt</span><span class="mtk1">(</span><span class="mtk6">&quot;User123!&quot;</span><span class="mtk1">, </span><span class="mtk9">new</span><span class="mtk1"> </span><span class="mtk3">SHA256Encoder</span><span class="mtk1">()),</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                            </span><span class="mtk11">UserName</span><span class="mtk1">.</span><span class="mtk3">from</span><span class="mtk1">(</span><span class="mtk6">&quot;user&quot;</span><span class="mtk1"> </span><span class="mtk8">+</span><span class="mtk1"> i)));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk11">participantIds</span><span class="mtk1">.</span><span class="mtk3">add</span><span class="mtk1">(</span><span class="mtk11">savedMember</span><span class="mtk1">.</span><span class="mtk3">getId</span><span class="mtk1">());</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">CountDownLatch</span><span class="mtk1"> </span><span class="mtk4">latch</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk9">new</span><span class="mtk1"> </span><span class="mtk3">CountDownLatch</span><span class="mtk1">(numOfParticipants);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">ExecutorService</span><span class="mtk1"> </span><span class="mtk4">executor</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">Executors</span><span class="mtk1">.</span><span class="mtk3">newFixedThreadPool</span><span class="mtk1">(numOfParticipants);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9">for</span><span class="mtk1"> (</span><span class="mtk11">Long</span><span class="mtk1"> </span><span class="mtk4">participantId</span><span class="mtk1"> </span><span class="mtk9">:</span><span class="mtk1"> participantIds) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk11">executor</span><span class="mtk1">.</span><span class="mtk3">submit</span><span class="mtk1">(() </span><span class="mtk9">-&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk9">try</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                    </span><span class="mtk11">participateService</span><span class="mtk1">.</span><span class="mtk3">participate</span><span class="mtk1">(groupId, participantId);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                } </span><span class="mtk9">finally</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                    </span><span class="mtk11">latch</span><span class="mtk1">.</span><span class="mtk3">countDown</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            });</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">executor</span><span class="mtk1">.</span><span class="mtk3">shutdown</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">latch</span><span class="mtk1">.</span><span class="mtk3">await</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9">long</span><span class="mtk1"> </span><span class="mtk4">actual</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">participateService</span><span class="mtk1">.</span><span class="mtk3">findParticipants</span><span class="mtk1">(groupId).</span><span class="mtk3">size</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">assertThat</span><span class="mtk1">(actual).</span><span class="mtk3">isEqualTo</span><span class="mtk1">(capacity);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>결과를 살펴보면 아래와 같이 3명의 인원 제한이 있는 모임인데 11명의 참여자가 발생하게 되었습니다. 즉, 동시성 문제에 대한 제어가 필요한 상황입니다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 13.999999999999998%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAoklEQVQI11XN2Q6CMBCFYV7HjVZwgUIXKIpUiVyY+P5P8luIF3rx5ZxMJjPJ9AxMrzfXMOL7QNffuQwPatdRWb+onUeZFt1e0K5FCYGWkny3Y7Ve/0lEaVE+cGrvnKPCPyi7kVMTOLphMc8P9oaor0jV4PaSPs8x8WghUoo0pYxPZom2DbW2PwxVtHTzFbuOaeJuqSq6LGM45FRSkG63X5slP4SjZTpQPH/1AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Untitled"
        title="Untitled"
        src="/static/0ca2bac81c96d1e4f8331ad99a4ffe7d/c1b63/img.png"
        srcset="/static/0ca2bac81c96d1e4f8331ad99a4ffe7d/5a46d/img.png 300w,
/static/0ca2bac81c96d1e4f8331ad99a4ffe7d/0a47e/img.png 600w,
/static/0ca2bac81c96d1e4f8331ad99a4ffe7d/c1b63/img.png 1200w,
/static/0ca2bac81c96d1e4f8331ad99a4ffe7d/5fada/img.png 1706w"
        sizes="(max-width: 1200px) 100vw, 1200px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
    </span></p>
<h1 id="해결-과정-1---synchronized" style="position:relative;"><a href="#%ED%95%B4%EA%B2%B0-%EA%B3%BC%EC%A0%95-1---synchronized" aria-label="해결 과정 1   synchronized permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>해결 과정 1 - synchronized</h1>
<p>첫번째 해결 책으로는 자바에서 하나의 스레드만이 임계 구역(Critical Section)에 접근하도록 지원해주는 <code>synchronized</code>를 통해 해결하였습니다. 단순히 기존 참여 메서드에 <code>synchronized</code>만 붙여주는 작업만으로도 기존에 발생하던 동시성 문제를 해결할 수 있었습니다.</p>
<h2 id="코드-및-결과" style="position:relative;"><a href="#%EC%BD%94%EB%93%9C-%EB%B0%8F-%EA%B2%B0%EA%B3%BC" aria-label="코드 및 결과 permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>코드 및 결과</h2>
<pre class="grvsc-container one-dark-pro" data-language="java" data-index="2"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">RequiredArgsConstructor</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">Transactional</span><span class="mtk4">(</span><span class="mtk7">readOnly</span><span class="mtk4"> </span><span class="mtk8">=</span><span class="mtk4"> </span><span class="mtk7">true</span><span class="mtk4">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">Service</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">public</span><span class="mtk4"> </span><span class="mtk9">class</span><span class="mtk4"> </span><span class="mtk11">ParticipateService</span><span class="mtk4"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">private</span><span class="mtk4"> </span><span class="mtk9">final</span><span class="mtk4"> </span><span class="mtk11">MemberFindService</span><span class="mtk4"> memberFindService</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">private</span><span class="mtk4"> </span><span class="mtk9">final</span><span class="mtk4"> </span><span class="mtk11">GroupFindService</span><span class="mtk4"> groupFindService</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk1">@</span><span class="mtk11">Transactional</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">public</span><span class="mtk3"> </span><span class="mtk9">synchronized</span><span class="mtk3"> </span><span class="mtk9">void</span><span class="mtk3"> participate</span><span class="mtk1">(</span><span class="mtk11">Long</span><span class="mtk1"> </span><span class="mtk4 mtki">groupId</span><span class="mtk1">, </span><span class="mtk11">Long</span><span class="mtk1"> </span><span class="mtk4 mtki">memberId</span><span class="mtk1">)</span><span class="mtk3"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">Group</span><span class="mtk1"> </span><span class="mtk4">group</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">groupFindService</span><span class="mtk1">.</span><span class="mtk3">findGroup</span><span class="mtk1">(groupId);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">Member</span><span class="mtk1"> </span><span class="mtk4">member</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">memberFindService</span><span class="mtk1">.</span><span class="mtk3">findMember</span><span class="mtk1">(memberId);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">group</span><span class="mtk1">.</span><span class="mtk3">participate</span><span class="mtk1">(member);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1064px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 12%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAgElEQVQI1zWKSw6CMABEuQvRjUqM6AbRUiNQY4si9nf/gzyLxsXLm5lMtjw0FKKl6kfq20QpNetjz6ZWrKrum4uTYrFvyHdn8lL8mPO/J2/TZyYTjURcJEornPOEEHlbi/ceax0xxrQFXtOE1oZheGDMgEl+jiPaGO5pb9uOa+IDtJZHfqaweKkAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Untitled"
        title="Untitled"
        src="/static/2c2fcb14468ed88dce4dff85028df3e4/dd104/img_1.png"
        srcset="/static/2c2fcb14468ed88dce4dff85028df3e4/5a46d/img_1.png 300w,
/static/2c2fcb14468ed88dce4dff85028df3e4/0a47e/img_1.png 600w,
/static/2c2fcb14468ed88dce4dff85028df3e4/dd104/img_1.png 1064w"
        sizes="(max-width: 1064px) 100vw, 1064px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
    </span></p>
<blockquote>
<p>관련 PR: <a href="https://github.com/woowacourse-teams/2022-momo/pull/431">https://github.com/woowacourse-teams/2022-momo/pull/431</a></p>
</blockquote>
<h2 id="남아있는-문제" style="position:relative;"><a href="#%EB%82%A8%EC%95%84%EC%9E%88%EB%8A%94-%EB%AC%B8%EC%A0%9C" aria-label="남아있는 문제 permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>남아있는 문제</h2>
<p>하지만 해당 방법은 단일 서버에서는 해결법이 될 수 있으나, N개의 서버를 운영하는 분산 환경에서는 각각의 서버에서 1개의 요청씩 동작시킨다 하더라도 전체적인 시스템을 보면 N개의 동일 요청이 실행되어 동시 접근을 제어하지 못하게 됩니다.</p>
<p>그럼 다중 서버에서 동시성 문제를 해결하는 방법은 무엇이 있을까요?? 이를 해결하기 위해서는 JPA에서 제공하는 <strong>낙관적락</strong>, 데이터베이스에 x-lock을 거는 <strong>비관적락</strong>, 락은 관리하는 외부 데이터베이스를 이용한 <strong>분산락</strong>이 존재합니다. 이 중에서 모두모여라 팀은 먼저 낙관적락과 비관적락을 고려하며 로직을 수정해봤습니다.</p>
<blockquote>
<p>📌 해당 게시글은 프로젝트에서 발생한 문제를 기록하고 정리하는 게시글인 만큼 자세한 이론에 대해 다루지 않고 있습니다. 낙관적락, 비관적락, 분산락에 대해 자세히 알고싶으시면 아래의 포스트를 확인해주시기 바랍니다.</p>
<p><a href="https://seongwon.dev/Spring-MVC/20230430-%EB%B9%84%EA%B4%80%EC%A0%81%EB%9D%BD%EA%B3%BC_%EB%82%99%EA%B4%80%EC%A0%81%EB%9D%BD/">비관적 락(Pessimistic Lock)과 낙관적 락(Optimistic Lock)</a></p>
<p><a href="https://seongwon.dev/MSA/20230503-Redis%EB%A5%BC_%ED%86%B5%ED%95%9C_%EB%B6%84%EC%82%B0%EB%9D%BD%EC%9C%BC%EB%A1%9C_%EB%8F%99%EC%8B%9C%EC%84%B1_%EB%AC%B8%EC%A0%9C_%EC%A0%9C%EC%96%B4%ED%95%98%EA%B8%B0/">Redis를 통한 분산락(Distribution Lock)으로 동시성 문제 제어하기</a></p>
</blockquote>
<h1 id="해결-과정-2---비관적-락-vs-낙관적-락" style="position:relative;"><a href="#%ED%95%B4%EA%B2%B0-%EA%B3%BC%EC%A0%95-2---%EB%B9%84%EA%B4%80%EC%A0%81-%EB%9D%BD-vs-%EB%82%99%EA%B4%80%EC%A0%81-%EB%9D%BD" aria-label="해결 과정 2   비관적 락 vs 낙관적 락 permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>해결 과정 2 - 비관적 락 vs 낙관적 락</h1>
<p>우리 팀은 서비스의 특성을 고려하여 낙관적 락과 비관적 락 중 비관적 락을 선택 및 적용하였습니다. 선택 이유는 충돌에 대한 잦은 롤백 처리로 인해 성능이 더 안 좋아질 수 있기 때문이었다.</p>
<p>이해를 돕기 위해 상황 예시를 한번 들어보겠습니다. 10명만 참여 가능한 모임 서비스에 낙관적 락이 걸려있고 1000명이 동시 요청을 하였다 가정하면 최초로 데이터베이스에 Commit 요청이 처리된 1명은 통과하며 엔티티의 버전을 변경하게 됩니다. 그리고 이후의 남은 999명은 업데이트 시점에 버전을 확인하였는데 버전이 변경되었기에 취소되고 애플리케이션에서 오류 처리 로직에 따라 다시 재시도를 요청하게 됩니다. 그리고 다음 한명이 요청을 처리하게되고 남은 998명은 다시 새로운 버전을 읽고 재시도를 해야한다…(반복)</p>
<p>이와 같이 인기 있는 모임에 참여 동시 요청이 발생할 경우, 잦은 충돌로 인한 낙관적 락의 오류 처리 비용으로 인해 성능에 더 영향을 줄 것이라 판단해 비관적 락을 택하였습니다.</p>
<h2 id="코드-및-결과-1" style="position:relative;"><a href="#%EC%BD%94%EB%93%9C-%EB%B0%8F-%EA%B2%B0%EA%B3%BC-1" aria-label="코드 및 결과 1 permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>코드 및 결과</h2>
<p>비관적 락을 적용한 코드는 아래와 같습니다.</p>
<pre class="grvsc-container one-dark-pro" data-language="java" data-index="3"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">public</span><span class="mtk4"> </span><span class="mtk9">interface</span><span class="mtk4"> </span><span class="mtk11">GroupSearchRepository</span><span class="mtk4"> </span><span class="mtk9">extends</span><span class="mtk4"> </span><span class="mtk11">Repository</span><span class="mtk1">&lt;</span><span class="mtk11">Group</span><span class="mtk1">,</span><span class="mtk4"> </span><span class="mtk11">Long</span><span class="mtk1">&gt;,</span><span class="mtk4"> </span><span class="mtk11">GroupSearchRepositoryCustom</span><span class="mtk4"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk1">@</span><span class="mtk11">Lock</span><span class="mtk4">(</span><span class="mtk7">value</span><span class="mtk4"> </span><span class="mtk8">=</span><span class="mtk4"> </span><span class="mtk11">LockModeType</span><span class="mtk1">.</span><span class="mtk4">PESSIMISTIC_WRITE)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk1">@</span><span class="mtk11">Query</span><span class="mtk4">(</span><span class="mtk6">&quot;select g from Group g where g.id = :id&quot;</span><span class="mtk4">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk11">Optional</span><span class="mtk1">&lt;</span><span class="mtk11">Group</span><span class="mtk1">&gt;</span><span class="mtk3"> findByIdForUpdate</span><span class="mtk1">(@</span><span class="mtk11">Param</span><span class="mtk1">(</span><span class="mtk6">&quot;id&quot;</span><span class="mtk1">) </span><span class="mtk11">Long</span><span class="mtk1"> </span><span class="mtk4 mtki">id</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk1">...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<pre class="grvsc-container one-dark-pro" data-language="java" data-index="4"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">RequiredArgsConstructor</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">Transactional</span><span class="mtk4">(</span><span class="mtk7">readOnly</span><span class="mtk4"> </span><span class="mtk8">=</span><span class="mtk4"> </span><span class="mtk7">true</span><span class="mtk4">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">Service</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">public</span><span class="mtk4"> </span><span class="mtk9">class</span><span class="mtk4"> </span><span class="mtk11">GroupFindService</span><span class="mtk4"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">private</span><span class="mtk4"> </span><span class="mtk9">final</span><span class="mtk4"> </span><span class="mtk11">GroupSearchRepository</span><span class="mtk4"> groupSearchRepository</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">private</span><span class="mtk4"> </span><span class="mtk9">final</span><span class="mtk4"> </span><span class="mtk11">ParticipantRepository</span><span class="mtk4"> participantRepository</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk1">...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">public</span><span class="mtk3"> </span><span class="mtk11">Group</span><span class="mtk3"> findByIdForUpdate</span><span class="mtk1">(</span><span class="mtk11">Long</span><span class="mtk1"> </span><span class="mtk4 mtki">id</span><span class="mtk1">)</span><span class="mtk3"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9">return</span><span class="mtk1"> </span><span class="mtk11">groupSearchRepository</span><span class="mtk1">.</span><span class="mtk3">findByIdForUpdate</span><span class="mtk1">(id)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                .</span><span class="mtk3">orElseThrow</span><span class="mtk1">(() </span><span class="mtk9">-&gt;</span><span class="mtk1"> </span><span class="mtk9">new</span><span class="mtk1"> </span><span class="mtk3">GroupException</span><span class="mtk1">(NOT_EXIST));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk1">...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<pre class="grvsc-container one-dark-pro" data-language="java" data-index="5"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">RequiredArgsConstructor</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">Transactional</span><span class="mtk4">(</span><span class="mtk7">readOnly</span><span class="mtk4"> </span><span class="mtk8">=</span><span class="mtk4"> </span><span class="mtk7">true</span><span class="mtk4">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">Service</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">public</span><span class="mtk4"> </span><span class="mtk9">class</span><span class="mtk4"> </span><span class="mtk11">ParticipateService</span><span class="mtk4"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">private</span><span class="mtk4"> </span><span class="mtk9">final</span><span class="mtk4"> </span><span class="mtk11">MemberFindService</span><span class="mtk4"> memberFindService</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">private</span><span class="mtk4"> </span><span class="mtk9">final</span><span class="mtk4"> </span><span class="mtk11">GroupFindService</span><span class="mtk4"> groupFindService</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk1">@</span><span class="mtk11">Transactional</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">public</span><span class="mtk3"> </span><span class="mtk9">void</span><span class="mtk3"> participate</span><span class="mtk1">(</span><span class="mtk11">Long</span><span class="mtk1"> </span><span class="mtk4 mtki">groupId</span><span class="mtk1">, </span><span class="mtk11">Long</span><span class="mtk1"> </span><span class="mtk4 mtki">memberId</span><span class="mtk1">)</span><span class="mtk3"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">Group</span><span class="mtk1"> </span><span class="mtk4">group</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">groupFindService</span><span class="mtk1">.</span><span class="mtk3">findByIdForUpdate</span><span class="mtk1">(groupId);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">Member</span><span class="mtk1"> </span><span class="mtk4">member</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">memberFindService</span><span class="mtk1">.</span><span class="mtk3">findMember</span><span class="mtk1">(memberId);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">group</span><span class="mtk1">.</span><span class="mtk3">participate</span><span class="mtk1">(member);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk1">...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 964px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 13.666666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAoElEQVQI12WMSw6CMBiEOYNEV3oBDSxcuZDSliIq0scPBe5/kbFtTDRxMflmJpPJDheJsiGUklAIi/1ZYVvUf9oVHPmpQn6svvxo8+MzJiVU34GmGdO8gvwCQxNcyJHaEtw4p769P1ELhVoq8KYFl22iaG6Jsc8qJnDlDF3/gCMfDhz6QcOGMxPOYnbRO4Jf1pRf2qRuMC7sRtDoEwdt8Qbz1Gpf8ZGfDwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Untitled"
        title="Untitled"
        src="/static/32a899415d77db829dc7ba99100d24e1/72aae/img_2.png"
        srcset="/static/32a899415d77db829dc7ba99100d24e1/5a46d/img_2.png 300w,
/static/32a899415d77db829dc7ba99100d24e1/0a47e/img_2.png 600w,
/static/32a899415d77db829dc7ba99100d24e1/72aae/img_2.png 964w"
        sizes="(max-width: 964px) 100vw, 964px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
    </span></p>
<p>테스트를 실행한 결과 정상적으로 통과하며 문제를 해결할 수 있었습니다.</p>
<h2 id="남아있는-문제-1" style="position:relative;"><a href="#%EB%82%A8%EC%95%84%EC%9E%88%EB%8A%94-%EB%AC%B8%EC%A0%9C-1" aria-label="남아있는 문제 1 permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>남아있는 문제</h2>
<p>비관적 락을 적용하며 다중 서버에서 동시성 문제를 해결할 수는 있었으나 데이터 베이스에 x-lock을 걸게 되며 쓰기 뿐만 아니라 데이터 조회에도 영향을 주는 문제가 발생했습니다.</p>
<pre class="grvsc-container one-dark-pro" data-language="java" data-index="6"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">RequiredArgsConstructor</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">Transactional</span><span class="mtk4">(</span><span class="mtk7">readOnly</span><span class="mtk4"> </span><span class="mtk8">=</span><span class="mtk4"> </span><span class="mtk7">true</span><span class="mtk4">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">Service</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">public</span><span class="mtk4"> </span><span class="mtk9">class</span><span class="mtk4"> </span><span class="mtk11">ParticipateService</span><span class="mtk4"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">private</span><span class="mtk4"> </span><span class="mtk9">final</span><span class="mtk4"> </span><span class="mtk11">MemberFindService</span><span class="mtk4"> memberFindService</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">private</span><span class="mtk4"> </span><span class="mtk9">final</span><span class="mtk4"> </span><span class="mtk11">GroupFindService</span><span class="mtk4"> groupFindService</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk1">@</span><span class="mtk11">Transactional</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">public</span><span class="mtk3"> </span><span class="mtk9">void</span><span class="mtk3"> participate</span><span class="mtk1">(</span><span class="mtk11">Long</span><span class="mtk1"> </span><span class="mtk4 mtki">groupId</span><span class="mtk1">, </span><span class="mtk11">Long</span><span class="mtk1"> </span><span class="mtk4 mtki">memberId</span><span class="mtk1">)</span><span class="mtk3"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk5 mtki">// findByIdForUpdate -&gt; SELECT FOR UPDATE를 통한 x-lock 획득</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">Group</span><span class="mtk1"> </span><span class="mtk4">group</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">groupFindService</span><span class="mtk1">.</span><span class="mtk3">findByIdForUpdate</span><span class="mtk1">(groupId);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">Member</span><span class="mtk1"> </span><span class="mtk4">member</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">memberFindService</span><span class="mtk1">.</span><span class="mtk3">findMember</span><span class="mtk1">(memberId);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk5 mtki">// group 객체는 capacity와 참여자의 정보를 얻기 위한 그래프 탐색을 하기 위해 획득</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk5 mtki">// group 테이블에는 변경 X, Participants 테이블에만 새로운 참가자 데이터가 추가됨</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">group</span><span class="mtk1">.</span><span class="mtk3">participate</span><span class="mtk1">(member);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>위의 로직을 살펴보면 <code>participate()</code> 메서드가 실행됨과 동시에 <code>SELECT FOR UPDATE</code>를 통해 Group정보를 얻으며 해당 데이터에 x-lock을 걸며 다른 읽기, 쓰기 요청에 대한 모든 접근을 제한하였습니다. <strong>즉, 모임 참여 요청을 처리하는 과정에서 모임 테이블에 변동을 주지 않음에도 불구하고 모임 조회에 대한 접근도 막게 되며 조회 성능에도 영향을 주게 된겁니다.</strong></p>
<h1 id="해결-과정-3---redis-분산락" style="position:relative;"><a href="#%ED%95%B4%EA%B2%B0-%EA%B3%BC%EC%A0%95-3---redis-%EB%B6%84%EC%82%B0%EB%9D%BD" aria-label="해결 과정 3   redis 분산락 permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>해결 과정 3 - Redis 분산락</h1>
<p>비관적 락으로 발생함 문제를 해결하기 위해 최종적으로 분산락 적용을 고려하게 됐습니다. 분산락은 기존 코드처럼 데이터베이스 row에 Lock을 거는 것이 아닌 직접적으로 참여하기 로직을 수행하는 부분(Critical Section)에 걸며 모임 테이블의 조회에는 영향을 주지 않을 수 있습니다.</p>
<h2 id="사용-기술-선정" style="position:relative;"><a href="#%EC%82%AC%EC%9A%A9-%EA%B8%B0%EC%88%A0-%EC%84%A0%EC%A0%95" aria-label="사용 기술 선정 permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>사용 기술 선정</h2>
<p>분산락은 MySQL, Redis, Zookeeper 등을 통해 구현할 수 있습니다. 여러 기업들이 분산락을 사용 사례를 보면 카카오, 토스와 마켓 컬리 등 많은 기업들에서 Redis를 통한 분산락을 구현하였습니다. 그렇다고 MySQL을 사용하지 않는 것은 아닙니다. 우아한형제들의 기술 블로그를 보면 광고 시스템에서는 MySQL을 사용한 것을 확인할 수 있습니다.</p>
<blockquote>
<p>📌 IT 기업들의 분산락 적용 포스트</p>
<ul>
<li><a href="https://helloworld.kurly.com/blog/distributed-redisson-lock/">풀필먼트 입고 서비스팀에서 분산락을 사용하는 방법 - Spring Redisson</a></li>
<li><a href="https://techblog.woowahan.com/2631/">MySQL을 이용한 분산락으로 여러 서버에 걸친 동시성 관리 | 우아한형제들 기술블로그</a></li>
</ul>
</blockquote>
<p>모모팀은 위의 여러 방법 중 Redis를 택했습니다. Redis를 택한 이유는 사전에 글로벌 캐시를 구축하며 Redis 환경을 구축하며 별도의 추가적인 인프라 구축이 필요없다는 점입니다. 물론 MySQL 서버도 구축되어 있으나 Redis와 MySQL을 비교해봤을 때, Redis의 처리 속도가 더 빠르고 락을 위한 MySQL의 부하를 발생시키지 않기 위해 이와 같은 선택을 하였습니다.</p>
<h3 id="lettuce-vs-redisson" style="position:relative;"><a href="#lettuce-vs-redisson" aria-label="lettuce vs redisson permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Lettuce vs Redisson</h3>
<p>Redis를 통한 분산락 구현은 대표적으로 Lettuce와 Redisson이라는 RedisClient 중 하나를 사용합니다. 각각 분산락을 구현하였을 때 특징을 간단히 설명하자면 Lettuce는 Spin Lock 방식으로 락에 대한 획득 시도를 지속적으로 해야하며 락에 대한 타임 아웃을 지정할 수 없다는 특징이 있습니다. 반면 Redisson은 pub/sub 방식으로 동작해 레디스 서버의 부하 문제를 줄여줄 수 있고 락에 타임 아웃을 지정할 수 있다는 특징이 있습니다.</p>
<p>이러한 특징을 고려하여 Reddison을 최종적으로 사용하였습니다.</p>
<h2 id="분산락-적용" style="position:relative;"><a href="#%EB%B6%84%EC%82%B0%EB%9D%BD-%EC%A0%81%EC%9A%A9" aria-label="분산락 적용 permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>분산락 적용</h2>
<p>분산락을 사용하는 비즈니스 코드에 Redisson을 통해 락을 획득하고 락을 풀어주는 코드들이 추가될 것입니다. 이는 비즈니스 코드를 복잡하게 만들고 분산락을 사용하게 되는 부분에 코드의 중복이 생겨 유지보수를 어렵게 됩니다. 이를 위해 AOP를 통해 어노테이션 기반으로 분산락을 쉽게 구현하고자 합니다.</p>
<h3 id="의존성-추가" style="position:relative;"><a href="#%EC%9D%98%EC%A1%B4%EC%84%B1-%EC%B6%94%EA%B0%80" aria-label="의존성 추가 permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>의존성 추가</h3>
<pre class="grvsc-container one-dark-pro" data-language="" data-index="7"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source">dependencies {</span></span>
<span class="grvsc-line"><span class="grvsc-source">	...</span></span>
<span class="grvsc-line"><span class="grvsc-source">	implementation &#39;org.redisson:redisson-spring-boot-starter:3.17.7&#39;</span></span>
<span class="grvsc-line"><span class="grvsc-source">}</span></span></code></pre>
<p>Redis Client인 Redisson을 사용하기 위해 의존성을 추가해줍니다.</p>
<h3 id="distributionlockjava" style="position:relative;"><a href="#distributionlockjava" aria-label="distributionlockjava permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DistributionLock.java</h3>
<pre class="grvsc-container one-dark-pro" data-language="java" data-index="8"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">import</span><span class="mtk4"> </span><span class="mtk11">java.lang.annotation.ElementType</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">import</span><span class="mtk4"> </span><span class="mtk11">java.lang.annotation.Retention</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">import</span><span class="mtk4"> </span><span class="mtk11">java.lang.annotation.RetentionPolicy</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">import</span><span class="mtk4"> </span><span class="mtk11">java.lang.annotation.Target</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">import</span><span class="mtk4"> </span><span class="mtk11">java.util.concurrent.TimeUnit</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">Target</span><span class="mtk4">(</span><span class="mtk11">ElementType</span><span class="mtk1">.</span><span class="mtk4">METHOD)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">Retention</span><span class="mtk4">(</span><span class="mtk11">RetentionPolicy</span><span class="mtk1">.</span><span class="mtk4">RUNTIME)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">public</span><span class="mtk4"> </span><span class="mtk1">@</span><span class="mtk9">interface</span><span class="mtk4"> </span><span class="mtk11">DistributionLock</span><span class="mtk4"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk11">String</span><span class="mtk4"> </span><span class="mtk3">key</span><span class="mtk4">()</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">long</span><span class="mtk4"> </span><span class="mtk3">waitTime</span><span class="mtk4">() </span><span class="mtk9">default</span><span class="mtk4"> </span><span class="mtk7">5L</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">long</span><span class="mtk4"> </span><span class="mtk3">leaseTime</span><span class="mtk4">() </span><span class="mtk9">default</span><span class="mtk4"> </span><span class="mtk7">2L</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk11">TimeUnit</span><span class="mtk4"> </span><span class="mtk3">timeUnit</span><span class="mtk4">() </span><span class="mtk9">default</span><span class="mtk4"> </span><span class="mtk11">TimeUnit</span><span class="mtk1">.</span><span class="mtk4">SECONDS</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">}</span></span></span></code></pre>
<p>분산락을 통해 동시성 문제를 해결할 메서드에 붙일 어노테이션을 만들어줍니다. 유연한 사용을 위해 락에 사용될 키 값과 Redisson에서 락을 획득하기 위해 사용하는 메서드(<code>tryLock()</code>)의 파라미터 값들을 변수로 두어 락에 관한 설정을 쉽게 할 수 있게 하였습니다.</p>
<ul>
<li>waitTime : 락을 획득하기까지 기다리는 최대 시간 (시간이 지날 때까지 락을 획득하지 못하면 false를 반환)</li>
<li>leaseTime : 락의 타임아웃을 설정 (설정 시간만큼 지나면 락이 만료되어 스스로 해제)</li>
<li>timeUnit : 락 설정 값에 사용될 시간 타입</li>
</ul>
<h3 id="distributionlockkeygeneratorjava" style="position:relative;"><a href="#distributionlockkeygeneratorjava" aria-label="distributionlockkeygeneratorjava permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DistributionLockKeyGenerator.java</h3>
<pre class="grvsc-container one-dark-pro" data-language="java" data-index="9"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">import</span><span class="mtk4"> </span><span class="mtk11">org.springframework.expression.ExpressionParser</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">import</span><span class="mtk4"> </span><span class="mtk11">org.springframework.expression.spel.standard.SpelExpressionParser</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">import</span><span class="mtk4"> </span><span class="mtk11">org.springframework.expression.spel.support.StandardEvaluationContext</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">public</span><span class="mtk4"> </span><span class="mtk9">class</span><span class="mtk4"> </span><span class="mtk11">DistributionLockKeyGenerator</span><span class="mtk4"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">public</span><span class="mtk3"> </span><span class="mtk9">static</span><span class="mtk3"> </span><span class="mtk11">Object</span><span class="mtk3"> generate</span><span class="mtk1">(</span><span class="mtk11">String</span><span class="mtk1"> </span><span class="mtk4 mtki">methodName</span><span class="mtk1">, </span><span class="mtk11">String</span><span class="mtk1">[] </span><span class="mtk4 mtki">parameterNames</span><span class="mtk1">, </span><span class="mtk11">Object</span><span class="mtk1">[] </span><span class="mtk4 mtki">args</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                                  </span><span class="mtk11">String</span><span class="mtk1"> </span><span class="mtk4 mtki">key</span><span class="mtk1">)</span><span class="mtk3"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">ExpressionParser</span><span class="mtk1"> </span><span class="mtk4">parser</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk9">new</span><span class="mtk1"> </span><span class="mtk3">SpelExpressionParser</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">StandardEvaluationContext</span><span class="mtk1"> </span><span class="mtk4">context</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk9">new</span><span class="mtk1"> </span><span class="mtk3">StandardEvaluationContext</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9">for</span><span class="mtk1"> (</span><span class="mtk9">int</span><span class="mtk1"> </span><span class="mtk4">i</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk7">0</span><span class="mtk1">; i </span><span class="mtk8">&lt;</span><span class="mtk1"> </span><span class="mtk11">parameterNames</span><span class="mtk1">.</span><span class="mtk4">length</span><span class="mtk1">; i++) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk11">context</span><span class="mtk1">.</span><span class="mtk3">setVariable</span><span class="mtk1">(parameterNames[i], args[i]);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9">return</span><span class="mtk1"> methodName </span><span class="mtk8">+</span><span class="mtk1"> </span><span class="mtk6">&quot;-&quot;</span><span class="mtk1"> </span><span class="mtk8">+</span><span class="mtk1"> </span><span class="mtk11">parser</span><span class="mtk1">.</span><span class="mtk3">parseExpression</span><span class="mtk1">(key).</span><span class="mtk3">getValue</span><span class="mtk1">(context, </span><span class="mtk11">Object</span><span class="mtk1">.</span><span class="mtk4">class</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>Lock에 사용될 키를 생성하는 클래스입니다. 키 값은 전달받은 메서드의 이름과 springframework의 <code>ExpressionParser</code>를 통해  파싱한 값을 통해 생성합니다.</p>
<h3 id="distributionlockaopjava" style="position:relative;"><a href="#distributionlockaopjava" aria-label="distributionlockaopjava permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DistributionLockAop.java</h3>
<pre class="grvsc-container one-dark-pro" data-language="java" data-index="10"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">import</span><span class="mtk4"> </span><span class="mtk11">java.lang.reflect.Method</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">import</span><span class="mtk4"> </span><span class="mtk11">org.aspectj.lang.ProceedingJoinPoint</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">import</span><span class="mtk4"> </span><span class="mtk11">org.aspectj.lang.annotation.Around</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">import</span><span class="mtk4"> </span><span class="mtk11">org.aspectj.lang.annotation.Aspect</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">import</span><span class="mtk4"> </span><span class="mtk11">org.aspectj.lang.reflect.MethodSignature</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">import</span><span class="mtk4"> </span><span class="mtk11">org.redisson.api.RLock</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">import</span><span class="mtk4"> </span><span class="mtk11">org.redisson.api.RedissonClient</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">import</span><span class="mtk4"> </span><span class="mtk11">org.springframework.stereotype.Component</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">import</span><span class="mtk4"> </span><span class="mtk11">lombok.RequiredArgsConstructor</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">import</span><span class="mtk4"> </span><span class="mtk11">lombok.extern.slf4j.Slf4j</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">import</span><span class="mtk4"> </span><span class="mtk11">com.woowacourse.momo.global.exception.exception.GlobalErrorCode</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">import</span><span class="mtk4"> </span><span class="mtk11">com.woowacourse.momo.global.exception.exception.MomoException</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">Component</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">Aspect</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">RequiredArgsConstructor</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">Slf4j</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">public</span><span class="mtk4"> </span><span class="mtk9">class</span><span class="mtk4"> </span><span class="mtk11">DistributionLockAop</span><span class="mtk4"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">private</span><span class="mtk4"> </span><span class="mtk9">static</span><span class="mtk4"> </span><span class="mtk9">final</span><span class="mtk4"> </span><span class="mtk11">String</span><span class="mtk4"> LOCK_PREFIX </span><span class="mtk8">=</span><span class="mtk4"> </span><span class="mtk6">&quot;LOCK: &quot;</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">private</span><span class="mtk4"> </span><span class="mtk9">final</span><span class="mtk4"> </span><span class="mtk11">RedissonClient</span><span class="mtk4"> redissonClient</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">private</span><span class="mtk4"> </span><span class="mtk9">final</span><span class="mtk4"> </span><span class="mtk11">TransactionGeneratorAop</span><span class="mtk4"> transactionGeneratorAop</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk1">@</span><span class="mtk11">Around</span><span class="mtk4">(</span><span class="mtk6">&quot;@annotation(com.woowacourse.momo.support.distributionlock.DistributionLock)&quot;</span><span class="mtk4">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">public</span><span class="mtk3"> </span><span class="mtk11">Object</span><span class="mtk3"> lock</span><span class="mtk1">(</span><span class="mtk11">ProceedingJoinPoint</span><span class="mtk1"> </span><span class="mtk4 mtki">joinPoint</span><span class="mtk1">)</span><span class="mtk3"> </span><span class="mtk9">throws</span><span class="mtk3"> </span><span class="mtk11">Throwable</span><span class="mtk3"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">MethodSignature</span><span class="mtk1"> </span><span class="mtk4">methodSignature</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> (MethodSignature) </span><span class="mtk11">joinPoint</span><span class="mtk1">.</span><span class="mtk3">getSignature</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">Method</span><span class="mtk1"> </span><span class="mtk4">method</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">methodSignature</span><span class="mtk1">.</span><span class="mtk3">getMethod</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">DistributionLock</span><span class="mtk1"> </span><span class="mtk4">distributionLock</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">method</span><span class="mtk1">.</span><span class="mtk3">getAnnotation</span><span class="mtk1">(</span><span class="mtk11">DistributionLock</span><span class="mtk1">.</span><span class="mtk4">class</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">String</span><span class="mtk1"> </span><span class="mtk4">key</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> LOCK_PREFIX </span><span class="mtk8">+</span><span class="mtk1"> </span><span class="mtk11">DistributionLockKeyGenerator</span><span class="mtk1">.</span><span class="mtk3">generate</span><span class="mtk1">(</span><span class="mtk11">methodSignature</span><span class="mtk1">.</span><span class="mtk3">getName</span><span class="mtk1">(),</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk11">methodSignature</span><span class="mtk1">.</span><span class="mtk3">getParameterNames</span><span class="mtk1">(), </span><span class="mtk11">joinPoint</span><span class="mtk1">.</span><span class="mtk3">getArgs</span><span class="mtk1">(), </span><span class="mtk11">distributionLock</span><span class="mtk1">.</span><span class="mtk3">key</span><span class="mtk1">());</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">RLock</span><span class="mtk1"> </span><span class="mtk4">lock</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">redissonClient</span><span class="mtk1">.</span><span class="mtk3">getLock</span><span class="mtk1">(key);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9">try</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk9">if</span><span class="mtk1"> (</span><span class="mtk8">!</span><span class="mtk11">lock</span><span class="mtk1">.</span><span class="mtk3">tryLock</span><span class="mtk1">(</span><span class="mtk11">distributionLock</span><span class="mtk1">.</span><span class="mtk3">waitTime</span><span class="mtk1">(), </span><span class="mtk11">distributionLock</span><span class="mtk1">.</span><span class="mtk3">leaseTime</span><span class="mtk1">(), </span><span class="mtk11">distributionLock</span><span class="mtk1">.</span><span class="mtk3">timeUnit</span><span class="mtk1">())) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk9">throw</span><span class="mtk1"> </span><span class="mtk9">new</span><span class="mtk1"> </span><span class="mtk3">MomoException</span><span class="mtk1">(</span><span class="mtk11">GlobalErrorCode</span><span class="mtk1">.</span><span class="mtk4">LOCK_ACQUISITION_FAILED_ERROR</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk11">log</span><span class="mtk1">.</span><span class="mtk3">info</span><span class="mtk1">(</span><span class="mtk6">&quot;lock - &quot;</span><span class="mtk1"> </span><span class="mtk8">+</span><span class="mtk1"> key);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk9">return</span><span class="mtk1"> </span><span class="mtk11">transactionGeneratorAop</span><span class="mtk1">.</span><span class="mtk3">proceed</span><span class="mtk1">(joinPoint);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        } </span><span class="mtk9">catch</span><span class="mtk1"> (</span><span class="mtk11">InterruptedException</span><span class="mtk1"> </span><span class="mtk4 mtki">e</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk11">log</span><span class="mtk1">.</span><span class="mtk3">error</span><span class="mtk1">(</span><span class="mtk11">e</span><span class="mtk1">.</span><span class="mtk3">getMessage</span><span class="mtk1">());</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk9">throw</span><span class="mtk1"> </span><span class="mtk9">new</span><span class="mtk1"> </span><span class="mtk3">MomoException</span><span class="mtk1">(</span><span class="mtk11">GlobalErrorCode</span><span class="mtk1">.</span><span class="mtk4">LOCK_INTERRUPTED_ERROR</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        } </span><span class="mtk9">finally</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk11">log</span><span class="mtk1">.</span><span class="mtk3">info</span><span class="mtk1">(</span><span class="mtk6">&quot;unlock - &quot;</span><span class="mtk1"> </span><span class="mtk8">+</span><span class="mtk1"> key);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk11">lock</span><span class="mtk1">.</span><span class="mtk3">unlock</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>앞서 생성한 <code>@DistributionLock</code> 어노테이션을 통해 수행할 AOP 설정 클래스 입니다. 동작과정은 아래와 같습니다.</p>
<ol>
<li><code>DistributionLockKeyGenerator.generate()</code> 메서드를 통해 Lock에 사용될 키 값을 생성한다.</li>
<li>redissonClient를 통해 <code>RLock</code> 인스턴스를 가져옵니다.</li>
<li><code>RLock.tryLock()</code> 메서드를 통해 최대 waitTime 시간만큼 락의 획득을 기다린다.</li>
<li>락의 획득이 가능하다면 leaseTime을 타임아웃으로 설정하며 락을 획득한다.</li>
<li>
<p>transactionGeneratorAop를 통해 새로운 트랜잭션을 생성하며 로직을 수행한다.</p>
<blockquote>
<p>해당 내용은 <code>TransactionGeneratorAop</code> 클래스의 설명을 하며 자세히 다루겠습니다.</p>
</blockquote>
</li>
</ol>
<h3 id="transactiongeneratoraopjava" style="position:relative;"><a href="#transactiongeneratoraopjava" aria-label="transactiongeneratoraopjava permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>TransactionGeneratorAop.java</h3>
<pre class="grvsc-container one-dark-pro" data-language="java" data-index="11"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">Component</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">public</span><span class="mtk4"> </span><span class="mtk9">class</span><span class="mtk4"> </span><span class="mtk11">TransactionGeneratorAop</span><span class="mtk4"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk1">@</span><span class="mtk11">Transactional</span><span class="mtk4">(</span><span class="mtk7">propagation</span><span class="mtk4"> </span><span class="mtk8">=</span><span class="mtk4"> </span><span class="mtk11">Propagation</span><span class="mtk1">.</span><span class="mtk4">REQUIRES_NEW)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">public</span><span class="mtk3"> </span><span class="mtk11">Object</span><span class="mtk3"> proceed</span><span class="mtk1">(</span><span class="mtk11">ProceedingJoinPoint</span><span class="mtk1"> </span><span class="mtk4 mtki">joinPoint</span><span class="mtk1">)</span><span class="mtk3"> </span><span class="mtk9">throws</span><span class="mtk3"> </span><span class="mtk11">Throwable</span><span class="mtk3"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9">return</span><span class="mtk1"> </span><span class="mtk11">joinPoint</span><span class="mtk1">.</span><span class="mtk3">proceed</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p><code>@Transactional(propagation = Propagation.REQUIRES_NEW)</code>를 통해 새로운 트랜잭션을 만들어 로직을 수행하는 AOP 클래스입니다.</p>
<p>해당 AOP를 통해 새로운 트랜잭션을 생성하지 않더라도 분산락 테스트는 정상적으로 통과합니다. 하지만 이럴 경우 분산락의 반납이 진행된 이후에 트랜잭션의 커밋이 발생하기에 희박한 가능성으로 예상하지 못한 동작으로 이어질 수 있습니다. 이해를 위해 그림으로 살펴보겠습니다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 84%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAACqklEQVQ4y5VUS08TURTu7/Ev6MpfoTuXxoUxbhDdGIUoEQKJ4iPBADGYgGEBacKCiIIiBqEwZaaddt7PzqMTihT6nH7eO840NAUfJzm5M3PufOe753znpnzfh2VZ8DwPhmmiXC6DWqfTiVaWZZHNZiGKIgRB6Mao8zyPfD4feS6Xg23bSFEAGtjd2QHHMLBLpeinMAyjlSYSRQGapiIIAgrXTZaQoWCO46BSqSCF2FxDB0wN59lxtUE213qYJys1CpZYKmEiFXhYBwxc4o6qwiHMPNeFrjtgMvNQhPkYKOwemXqr1YJJSpUkSSWZFEUhNSC19D3Uaqdo1Guo107IM2CIT2BLtxHt7LR7GLbb7V7AhGGRFHxwYgZ3Rqfx7F0aI7PLGJtL4/nCF+SYYbjq/Qiw8zfAJCBJElY/b2Bj6wc+rn/FQVGAoOsQjEPI/AhK8sC/ASYMBUHEo1dzGJiYxcPJOYy+WMDLqSW8nvkEbu8xYXivC5jU748MNU0Hw4tgZR35ggJ+JQM+vY3iqgCZGyGN+s8jG6Sz4dEh0cgR0GzEIoiTFYah5m72MoyjF3ZZLBSgZfdh5TnYmhapvkRcU02w3BoR8Fa/QE+qaCsiLE3rB7TIzxeZzaWRXR2H6waoBB6ZmDICXUOZZVDa34VIJq0PkNJuNZvRR9qoyNtN0JbpK9ehvL+EotMErxoQDZc8+9jkeKxlGBRF6RyGZCb77XfMWb8FffEyxj98IyqYxtCbeTx9MIWxwbcYujuJvUy2O/9dQLlYgLX9HT6ZFp9cGPRSKPsuTPcEwvI1uMtX0CR069UK8WPUnQCNUoBTy4NlGOePXoXUplqtnvGfODoF8ks3IC1ejVmHPWegIpJkuR+Q3nXhmRvkrJVMCbrEdo8VySZeqWzsuKH0/Re/1fOqIBfl2QAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Untitled"
        title="Untitled"
        src="/static/4a2a052553939efe95e1a1354a6b1170/c1b63/img_3.png"
        srcset="/static/4a2a052553939efe95e1a1354a6b1170/5a46d/img_3.png 300w,
/static/4a2a052553939efe95e1a1354a6b1170/0a47e/img_3.png 600w,
/static/4a2a052553939efe95e1a1354a6b1170/c1b63/img_3.png 1200w,
/static/4a2a052553939efe95e1a1354a6b1170/9f9a4/img_3.png 1560w"
        sizes="(max-width: 1200px) 100vw, 1200px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
    </span></p>
<p>분산락을 획득하고 반납이 트랜잭션 안에서 처리되면 위와 같이 이전에 동락한 트랜잭션(1번 트랜잭션)의 커밋이 되지 않아 락을 획득한 트랜잭션(2번 트랜잭션)에서 업데이트 된 데이터가 아닌 언두로그의 데이터를 읽어와 동시성 문제가 해결되지 않는 상황이 발생할 수 있습니다. 이러한 문제는 락을 획득하고 반납하는 로직 내에서 트랜잭션의 커밋까지 이루어지도록 변경하면 됩니다.</p>
<p>위에서 지정한 <code>TransactionGeneratorAop</code>를 통해 분산락을 통해 동작하는 로직을 새로운 트랜잭잭션 내에서 수행하도록 변경하면 락을 반납하기 이전에 트랜잭션의 커밋이 이루어져 아래와 같이 동작하게 됩니다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 82.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAACnElEQVQ4y5VUbU/TUBQm8Q8Y/4i/xMRvGuNvMPEr4SP6ATWGSAwhihjnywwyiATNdASIRGCsBkcLW5e9tOvrum6rY1C27vHcbq0ShnEnuWly77lPz3nO89yR3d1d8IKAvXQah6KIjuchiHK5jEQiAZ7nwXEcGo1GeKYoCra2tpBKpfwvy2HnIw3HQSGXQ2ZnG9r+TzRUBc2jFprNpp8gyzLy+QJc10Wn0/HBut2uv9iepmn+Ymdsb4QlmIaB3PZ3WLIETVWh6Tp0nRJ1C8L+GvL8HfqB3QfzQlAW7Ke1Wi3c8wGtSgWermBQOLU9VEvXYVeVgYAMzLbt84ALX9YRS2widVhAOq/goKRCKNkQcxsEeJMuaf8PWK/ZeDwbxfjMO0y9Xcbkq0VMv1/B0+hXbGzOw1FuoTpshUsrcSx+XsXipwTWkxwysgK+aCIrrsGWbtAldbgKJ55HMToVwcRcDPfHZjA5NotHoxGsrkTg6LdRtYap0LJgq2WgzaTRRsd20DZocrVTGBJN3+fwT4WBbC4ErJBsbC4JVGnapy5YqofeBVNPQhOvhRx6Xg/Q+xegRqrnSYeKsA8pm4FMDimToIvFEjngB7IHcVwUDhljYMsOOWNQnLhtSEoDhmmS2HWYNECDnKGTqyq08lwKdr1+fsr1cLPfktezWaWUBP/yKlRJZP2ifdJCxz2GS9S4chE6dXUekCoMjB8Q3u0DmmIc9deXkBF5JDNlEn4RXE7Gxp6A+dVvWNuhR2MYQCMbh7twGR+WP+Lugzk8jCxh/N4snoy9IGnN4c2zGNHlnAVk3PxtcP8bAJL1hOkrcKqB10mHxCvqLaB5CktSfF7PTplIDiYVyqL/Lh63jlAQ032pwJeL14PtyYY6++U44d3fhWvz1fp+ip4AAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Untitled"
        title="Untitled"
        src="/static/b1d24674e3fe62ada9ba8eba77550712/c1b63/img_4.png"
        srcset="/static/b1d24674e3fe62ada9ba8eba77550712/5a46d/img_4.png 300w,
/static/b1d24674e3fe62ada9ba8eba77550712/0a47e/img_4.png 600w,
/static/b1d24674e3fe62ada9ba8eba77550712/c1b63/img_4.png 1200w,
/static/b1d24674e3fe62ada9ba8eba77550712/7be33/img_4.png 1558w"
        sizes="(max-width: 1200px) 100vw, 1200px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
    </span></p>
<h3 id="비즈니스-로직" style="position:relative;"><a href="#%EB%B9%84%EC%A6%88%EB%8B%88%EC%8A%A4-%EB%A1%9C%EC%A7%81" aria-label="비즈니스 로직 permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>비즈니스 로직</h3>
<pre class="grvsc-container one-dark-pro" data-language="java" data-index="12"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">RequiredArgsConstructor</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">Service</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">public</span><span class="mtk4"> </span><span class="mtk9">class</span><span class="mtk4"> </span><span class="mtk11">ParticipateService</span><span class="mtk4"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">private</span><span class="mtk4"> </span><span class="mtk9">final</span><span class="mtk4"> </span><span class="mtk11">MemberFindService</span><span class="mtk4"> memberFindService</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">private</span><span class="mtk4"> </span><span class="mtk9">final</span><span class="mtk4"> </span><span class="mtk11">GroupFindService</span><span class="mtk4"> groupFindService</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk1">@</span><span class="mtk11">DistributionLock</span><span class="mtk4">(</span><span class="mtk7">key</span><span class="mtk4"> </span><span class="mtk8">=</span><span class="mtk4"> </span><span class="mtk6">&quot;#groupId&quot;</span><span class="mtk4">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">public</span><span class="mtk3"> </span><span class="mtk9">void</span><span class="mtk3"> participate</span><span class="mtk1">(</span><span class="mtk11">Long</span><span class="mtk1"> </span><span class="mtk4 mtki">groupId</span><span class="mtk1">, </span><span class="mtk11">Long</span><span class="mtk1"> </span><span class="mtk4 mtki">memberId</span><span class="mtk1">)</span><span class="mtk3"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">Group</span><span class="mtk1"> </span><span class="mtk4">group</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">groupFindService</span><span class="mtk1">.</span><span class="mtk3">findGroup</span><span class="mtk1">(groupId);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">Member</span><span class="mtk1"> </span><span class="mtk4">member</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">memberFindService</span><span class="mtk1">.</span><span class="mtk3">findMember</span><span class="mtk1">(memberId);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">group</span><span class="mtk1">.</span><span class="mtk3">participate</span><span class="mtk1">(member);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>이제 앞서 생성한 분산락 어노테이션을 비즈니스 로직에 적용하고 테스트해보겠습니다. 기존 비즈니스 로직과 다르게 내부 로직에서 새로운 트랜잭션을 만들기에 <code>@Transacitonal</code>을 제거하였습니다. <code>@Transactional</code>을 그대로 붙여둬도 되지만 불필요하게 더 많은 데이터베이스 커넥션을 사용하여 커넥션 고갈 문제가 발생할 수 있습니다. 이는 아래의 분산락을 적용하며 발생한 문제 파트에서 자세히 다루도록 하겠습니다.</p>
<h3 id="결과-확인" style="position:relative;"><a href="#%EA%B2%B0%EA%B3%BC-%ED%99%95%EC%9D%B8" aria-label="결과 확인 permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>결과 확인</h3>
<p>위의 로직을 적용 후 테스트를 진행해본 결과는 아래와 같이 성공적으로 통과하는 것을 확인할 수 있습니다. 또한 로그를 확인해보면 Lock의 획득과 Lock의 반납이 순차적으로 진행되는 것을 확인할 수 있습니다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 24%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAm0lEQVQY042QSw7CMAxEc55uW9TEnzgpKhJC4v63GeICLa1YdDGy45GfJg71/oTOD+SmVG6INi/1ohNSSiAijOMIVV3fZgZmRtd1GIZhmblPxAiUK9imncSuiJwRPwAHfYEOKqUcgNx8gYgiqBVoPsgqSLZEMcZzCdssSFve6QTwmNB7kTVhxa82YF5ADvHqC/8S9n3/Pknz/esvlUSozLWzkVkAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Untitled"
        title="Untitled"
        src="/static/7702e63f293866267cd800c41d933edd/c1b63/img_5.png"
        srcset="/static/7702e63f293866267cd800c41d933edd/5a46d/img_5.png 300w,
/static/7702e63f293866267cd800c41d933edd/0a47e/img_5.png 600w,
/static/7702e63f293866267cd800c41d933edd/c1b63/img_5.png 1200w,
/static/7702e63f293866267cd800c41d933edd/d61c2/img_5.png 1800w,
/static/7702e63f293866267cd800c41d933edd/97a96/img_5.png 2400w,
/static/7702e63f293866267cd800c41d933edd/79daf/img_5.png 2792w"
        sizes="(max-width: 1200px) 100vw, 1200px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
    </span></p>
<h2 id="발생한-문제" style="position:relative;"><a href="#%EB%B0%9C%EC%83%9D%ED%95%9C-%EB%AC%B8%EC%A0%9C" aria-label="발생한 문제 permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>발생한 문제</h2>
<h3 id="문제---트랜잭션을-새로-분리하며-실패하는-테스트" style="position:relative;"><a href="#%EB%AC%B8%EC%A0%9C---%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98%EC%9D%84-%EC%83%88%EB%A1%9C-%EB%B6%84%EB%A6%AC%ED%95%98%EB%A9%B0-%EC%8B%A4%ED%8C%A8%ED%95%98%EB%8A%94-%ED%85%8C%EC%8A%A4%ED%8A%B8" aria-label="문제   트랜잭션을 새로 분리하며 실패하는 테스트 permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>문제 - 트랜잭션을 새로 분리하며 실패하는 테스트</h3>
<p>트랜잭션을 분리하며 기존에 성공하던 관련 로직들이 실패하는 문제가 발생했습니다. 먼저 실패하는 테스트 중 한개를 살펴보겠습니다.</p>
<pre class="grvsc-container one-dark-pro" data-language="java" data-index="13"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">Transactional</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">TestConstructor</span><span class="mtk4">(</span><span class="mtk7">autowireMode</span><span class="mtk4"> </span><span class="mtk8">=</span><span class="mtk4"> </span><span class="mtk11">TestConstructor</span><span class="mtk1">.</span><span class="mtk11">AutowireMode</span><span class="mtk1">.</span><span class="mtk4">ALL)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">RequiredArgsConstructor</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">SpringBootTest</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">class</span><span class="mtk4"> </span><span class="mtk11">ParticipateServiceTest</span><span class="mtk4"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk1">...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">private</span><span class="mtk4"> </span><span class="mtk11">Group</span><span class="mtk4"> group</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">private</span><span class="mtk4"> </span><span class="mtk11">Member</span><span class="mtk4"> host</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">private</span><span class="mtk4"> </span><span class="mtk11">Member</span><span class="mtk4"> participant</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk1">@</span><span class="mtk11">BeforeEach</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">void</span><span class="mtk3"> setUp</span><span class="mtk1">()</span><span class="mtk3"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">host</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">memberRepository</span><span class="mtk1">.</span><span class="mtk3">save</span><span class="mtk1">(</span><span class="mtk11">MOMO</span><span class="mtk1">.</span><span class="mtk3">toMember</span><span class="mtk1">());</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">group</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">groupRepository</span><span class="mtk1">.</span><span class="mtk3">save</span><span class="mtk1">(</span><span class="mtk11">MOMO_STUDY</span><span class="mtk1">.</span><span class="mtk3">toGroup</span><span class="mtk1">(host));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">this</span><span class="mtk1">.</span><span class="mtk4">participant</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">memberRepository</span><span class="mtk1">.</span><span class="mtk3">save</span><span class="mtk1">(</span><span class="mtk11">DUDU</span><span class="mtk1">.</span><span class="mtk3">toMember</span><span class="mtk1">());</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk1">@</span><span class="mtk11">DisplayName</span><span class="mtk4">(</span><span class="mtk6">&quot;모임에 참여한다&quot;</span><span class="mtk4">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk1">@</span><span class="mtk11">Test</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">void</span><span class="mtk3"> participate</span><span class="mtk1">()</span><span class="mtk3"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9">long</span><span class="mtk1"> </span><span class="mtk4">groupId</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">group</span><span class="mtk1">.</span><span class="mtk3">getId</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9">long</span><span class="mtk1"> </span><span class="mtk4">participantId</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">participant</span><span class="mtk1">.</span><span class="mtk3">getId</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">participateService</span><span class="mtk1">.</span><span class="mtk3">participate</span><span class="mtk1">(groupId, participantId);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">List</span><span class="mtk1">&lt;</span><span class="mtk11">MemberResponse</span><span class="mtk1">&gt; </span><span class="mtk4">participants</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">participateService</span><span class="mtk1">.</span><span class="mtk3">findParticipants</span><span class="mtk1">(groupId);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">assertThat</span><span class="mtk1">(participants).</span><span class="mtk3">hasSize</span><span class="mtk1">(</span><span class="mtk7">2</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk1">...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 10.666666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAhUlEQVQI1w3Juw6CMABAUX5HoC9pCzVWUUyjJJgoPkZ3Jx38/muHs9xbpOub++vH8flhP3/ZrA/slKA3hlZKrBAspaLULbWyaKXQubvcg8xPSBaVoKwFVVashgvbNGc3YnrQ2ECvJJNznLPRNpklOc8pm1rP4D1j1xFdQNtI2URqE6ik4Q9loUMtDF/liwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Untitled"
        title="Untitled"
        src="/static/23081617bd7b91af464bc4157f20af8d/c1b63/img_6.png"
        srcset="/static/23081617bd7b91af464bc4157f20af8d/5a46d/img_6.png 300w,
/static/23081617bd7b91af464bc4157f20af8d/0a47e/img_6.png 600w,
/static/23081617bd7b91af464bc4157f20af8d/c1b63/img_6.png 1200w,
/static/23081617bd7b91af464bc4157f20af8d/d61c2/img_6.png 1800w,
/static/23081617bd7b91af464bc4157f20af8d/037ab/img_6.png 2274w"
        sizes="(max-width: 1200px) 100vw, 1200px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
    </span></p>
<p>기존에 정상적으로 통과하던 테스트가 “존재하지 않는 모임입니다.” 라는 예외와 함께 실패하게 됐습니다. 이러한 문제가 발생한 이유는 트랜잭션과 연관있습니다.</p>
<p>테스트는 각각의 테스트별 격리를 위해 클래스 레벨에 <code>@Transactional</code> 을 붙이며 테스트의 수행 후 Rollback이 되어 이후 테스트에 영향이 가지 않도록 했습니다. 테스트를 진행하는 <code>participate()</code>메서드는 분산락을 적용하기 전에는 비즈니스 로직에 <code>@Transactional</code>이 붙어있더라도 Default 설정값인 <code>Propagation.REQUIRED</code>으로 동작하며 테스트 메서드의 같은 트랜잭션 내에서 로직이 수행되게 되어 문제가 없었습니다. 하지만 분산락이 걸린 로직 내에서 <code>Propagation.REQUIRES_NEW</code>를 통해 <strong>새로운 트랜잭션을 만들어 수행하다보니 트랜잭션 격리에 의해 커밋되지 않은 부모 트랜잭션의 데이터를 읽지 못해 모임을 찾지 못하는 문제가 발생한 것입니다.</strong></p>
<p>이를 해결하기 위해 테스트 격리 방법을 <code>@Transactional</code>을 통해 롤백하는 방식이 아닌 <code>@Sql</code>을 통해 테스트의 실행 전에 데이터베이스의 테이블을 초기화는 방식으로 변경하며 문제를 해결했습니다.</p>
<pre class="grvsc-container one-dark-pro" data-language="java" data-index="14"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">Sql</span><span class="mtk4">(</span><span class="mtk7">value</span><span class="mtk4"> </span><span class="mtk8">=</span><span class="mtk4"> </span><span class="mtk6">&quot;classpath:init.sql&quot;</span><span class="mtk1">,</span><span class="mtk4"> </span><span class="mtk7">executionPhase</span><span class="mtk4"> </span><span class="mtk8">=</span><span class="mtk4"> BEFORE_TEST_METHOD)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">Sql</span><span class="mtk4">(</span><span class="mtk7">value</span><span class="mtk4"> </span><span class="mtk8">=</span><span class="mtk4"> </span><span class="mtk6">&quot;classpath:truncate.sql&quot;</span><span class="mtk1">,</span><span class="mtk4"> </span><span class="mtk7">executionPhase</span><span class="mtk4"> </span><span class="mtk8">=</span><span class="mtk4"> AFTER_TEST_METHOD)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">TestConstructor</span><span class="mtk4">(</span><span class="mtk7">autowireMode</span><span class="mtk4"> </span><span class="mtk8">=</span><span class="mtk4"> </span><span class="mtk11">TestConstructor</span><span class="mtk1">.</span><span class="mtk11">AutowireMode</span><span class="mtk1">.</span><span class="mtk4">ALL)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">RequiredArgsConstructor</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">@</span><span class="mtk11">SpringBootTest</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9">class</span><span class="mtk4"> </span><span class="mtk11">ParticipateServiceTest</span><span class="mtk4"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk1">...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk1">@</span><span class="mtk11">DisplayName</span><span class="mtk4">(</span><span class="mtk6">&quot;모임에 참여한다&quot;</span><span class="mtk4">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk1">@</span><span class="mtk11">Test</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk9">void</span><span class="mtk3"> participate</span><span class="mtk1">()</span><span class="mtk3"> </span><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9">long</span><span class="mtk1"> </span><span class="mtk4">groupId</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">group</span><span class="mtk1">.</span><span class="mtk3">getId</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9">long</span><span class="mtk1"> </span><span class="mtk4">participantId</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">participant</span><span class="mtk1">.</span><span class="mtk3">getId</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">participateService</span><span class="mtk1">.</span><span class="mtk3">participate</span><span class="mtk1">(groupId, participantId);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">List</span><span class="mtk1">&lt;</span><span class="mtk11">MemberResponse</span><span class="mtk1">&gt; </span><span class="mtk4">participants</span><span class="mtk1"> </span><span class="mtk8">=</span><span class="mtk1"> </span><span class="mtk11">participateService</span><span class="mtk1">.</span><span class="mtk3">findParticipants</span><span class="mtk1">(groupId);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">assertThat</span><span class="mtk1">(participants).</span><span class="mtk3">hasSize</span><span class="mtk1">(</span><span class="mtk7">2</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">    </span><span class="mtk1">...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<h1 id="reference" style="position:relative;"><a href="#reference" aria-label="reference permalink" class="toc-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>📚Reference</h1>
<ul>
<li><a href="https://helloworld.kurly.com/blog/distributed-redisson-lock/">풀필먼트 입고 서비스팀에서 분산락을 사용하는 방법 - Spring Redisson</a></li>
<li><a href="https://github.com/redisson/redisson">Redisson Repo</a></li>
<li><a href="https://velog.io/@chullll/JPA-%EB%9D%BD%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EC%9E%AC%EA%B3%A0-%EA%B4%80%EB%A6%AC">[JPA] 락을 이용한 재고 관리</a></li>
<li><a href="https://devfunny.tistory.com/888">SpringBoot 재고 감소 동시성 제어 - Redisson 사용 (+ AOP 적용)</a></li>
<li><a href="https://velog.io/@ohzzi/Redis%EB%A5%BC-%ED%99%9C%EC%9A%A9%ED%95%98%EC%97%AC-%EB%8F%99%EC%8B%9C%EC%84%B1-%EB%AC%B8%EC%A0%9C-%ED%95%B4%EA%B2%B0%ED%95%98%EA%B8%B0">Redis를 활용하여 동시성 문제 해결하기</a></li>
<li><a href="https://thalals.tistory.com/370">[Spring &#x26; Java] 🚀 재고시스템으로 알아보는 동시성이슈 해결방법</a></li>
</ul>
<style class="grvsc-styles">
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line > * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: ' ';
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {
    content: ' ';
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .one-dark-pro {
    background-color: #282c34;
    color: #abb2bf;
  }
  .one-dark-pro .mtki { font-style: italic; }
  .one-dark-pro .mtk1 { color: #ABB2BF; }
  .one-dark-pro .mtk11 { color: #E5C07B; }
  .one-dark-pro .mtk4 { color: #E06C75; }
  .one-dark-pro .mtk7 { color: #D19A66; }
  .one-dark-pro .mtk8 { color: #56B6C2; }
  .one-dark-pro .mtk9 { color: #C678DD; }
  .one-dark-pro .mtk3 { color: #61AFEF; }
  .one-dark-pro .mtk6 { color: #98C379; }
  .one-dark-pro .mtk5 { color: #7F848E; }
  .one-dark-pro .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
</style></div></div></div></div><div class="css-1bdwg0l etadk2t0"><div><style data-emotion-css="17t5ffy">.css-17t5ffy{margin-top:1rem;margin-bottom:1rem;}</style><div class="css-17t5ffy"><div class="css-1l4w6pd"><div class="css-1i57it9"></div></div></div><style data-emotion-css="i1cgbm">.css-i1cgbm{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;margin-top:1rem;padding-left:0.5rem;padding-right:0.5rem;}</style><div class="css-i1cgbm"><style data-emotion-css="16k19ub">.css-16k19ub{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;padding-left:0.75rem;padding-right:0.75rem;padding-top:0.25rem;padding-bottom:0.25rem;margin-top:0.5rem;margin-bottom:0.5rem;margin-left:0.5rem;border-radius:0.25rem;--text-opacity:1;color:rgba(255,255,255,var(--text-opacity));background-color:#2D87FD;}</style><button class="css-16k19ub"><style data-emotion-css="u7tj59">.css-u7tj59{fill:currentColor;margin-top:auto;margin-bottom:auto;margin-right:0.25rem;}</style><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 320 512" class="css-u7tj59" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M279.14 288l14.22-92.66h-88.91v-60.13c0-25.35 12.42-50.06 52.24-50.06h40.42V6.26S260.43 0 225.36 0c-73.22 0-121.08 44.38-121.08 124.72v70.62H22.89V288h81.39v224h100.17V288z"></path></svg>Share with <!-- -->Facebook</button><style data-emotion-css="9nr5sz">.css-9nr5sz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;padding-left:0.75rem;padding-right:0.75rem;padding-top:0.25rem;padding-bottom:0.25rem;margin-top:0.5rem;margin-bottom:0.5rem;margin-left:0.5rem;border-radius:0.25rem;--text-opacity:1;color:rgba(255,255,255,var(--text-opacity));background-color:#1CA1F2;}</style><button class="css-9nr5sz"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="css-u7tj59" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg>Share with <!-- -->Twitter</button><style data-emotion-css="rk0yc0">.css-rk0yc0{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;padding-left:0.75rem;padding-right:0.75rem;padding-top:0.25rem;padding-bottom:0.25rem;margin-top:0.5rem;margin-bottom:0.5rem;margin-left:0.5rem;border-radius:0.25rem;--text-opacity:1;color:rgba(255,255,255,var(--text-opacity));background-color:#6E7783;}</style><button class="css-rk0yc0"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="css-u7tj59" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"></path></svg>Share with <!-- -->Url</button></div></div><style data-emotion-css="14e3tt2">.css-14e3tt2{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;padding-left:0.5rem;padding-right:0.5rem;}</style><div class="css-14e3tt2"><style data-emotion-css="1cwag5x">.css-1cwag5x{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;padding-left:0.75rem;padding-right:0.75rem;padding-top:0.25rem;padding-bottom:0.25rem;margin-top:0.5rem;margin-bottom:0.5rem;border-radius:0.25rem;--text-opacity:1;color:rgba(255,255,255,var(--text-opacity));background-color:#FF813E;}</style><a target="_blank" rel="noopener noreferrer" href="https://www.buymeacoffee.com/seongwon" class="css-1cwag5x"><style data-emotion-css="9u48bm">.css-9u48bm{margin-right:0.5rem;}</style><img src="https://www.buymeacoffee.com/assets/img/BMC-btn-logo.svg" alt="Buy me a coffee" class="css-9u48bm"/><span>Buy me a coffee</span></a></div></div></div></div><div class="css-1bdwg0l etadk2t0"><style data-emotion-css="17t1oy1">.css-17t1oy1{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap-reverse;-ms-flex-wrap:wrap-reverse;flex-wrap:wrap-reverse;margin-left:0.5rem;margin-right:0.5rem;margin-top:1rem;}@media (min-width:768px){.css-17t1oy1{-webkit-flex-wrap:nowrap;-ms-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}}</style><div class="css-17t1oy1 eazp2vb0"><style data-emotion-css="1pwr1ry">.css-1pwr1ry{width:100%;margin:0.5rem;}@media (min-width:768px){.css-1pwr1ry{width:50%;margin:1rem;}}</style><div class="css-1pwr1ry eazp2vb1"><style data-emotion-css="6mrc3l">.css-6mrc3l{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:start;-webkit-justify-content:flex-start;-ms-flex-pack:start;justify-content:flex-start;-webkit-transition:all 300ms cubic-bezier(0.4,0,0.2,1);transition:all 300ms cubic-bezier(0.4,0,0.2,1);text-align:left;width:100%;height:100%;padding:0.5rem;background-color:#eee;border-radius:0.25rem;border-left-width:4px;border-color:#c6cefc;}.css-6mrc3l:hover{background-color:#ddd;}</style><a rel="prev" class="css-6mrc3l" href="/Database/20230515-모모팀_Redis캐시를_통한_성능_향상/"><style data-emotion-css="19o7xeo">.css-19o7xeo{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-content:center;-ms-flex-line-pack:center;align-content:center;margin-right:1rem;margin-left:0.5rem;height:100%;}</style><div class="css-19o7xeo"><style data-emotion-css="11za1ik">.css-11za1ik{width:2rem;height:2rem;margin-top:auto;margin-bottom:auto;}</style><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="css-11za1ik" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M872 474H286.9l350.2-304c5.6-4.9 2.2-14-5.2-14h-88.5c-3.9 0-7.6 1.4-10.5 3.9L155 487.8a31.96 31.96 0 0 0 0 48.3L535.1 866c1.5 1.3 3.3 2 5.2 2h91.5c7.4 0 10.8-9.2 5.2-14L286.9 550H872c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"></path></svg></div><style data-emotion-css="v38or">.css-v38or{display:inline-block;margin-top:0.5rem;margin-bottom:0.5rem;}</style><div class="css-v38or"><style data-emotion-css="2m7hin">.css-2m7hin{color:#3737B9;}</style><p class="css-2m7hin">이전 포스트</p><p>모모팀 Redis캐시를 통한 성능 향상</p></div></a></div><div class="css-1pwr1ry eazp2vb1"></div></div><style data-emotion-css="14yohw7">.css-14yohw7{width:100%;max-width:768px;padding-left:1rem;padding-right:1rem;margin-left:auto;margin-right:auto;padding-top:2rem;margin-top:0.5rem;margin-bottom:1rem;}@media (min-width:768px){.css-14yohw7{padding-left:0;padding-right:0;padding-top:3rem;}}</style><div class="css-14yohw7 e1b6rdiw0"><style data-emotion-css="180ky7f">.css-180ky7f{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding-left:0.5rem;padding-right:0.5rem;}@media (min-width:768px){.css-180ky7f{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}</style><div class="css-180ky7f e1b6rdiw1"><style data-emotion-css="p5b1u1">.css-p5b1u1{border-radius:9999px;border-width:1px;--border-opacity:1;border-color:rgba(214,188,250,var(--border-opacity));margin-right:2rem;margin-bottom:0.5rem;}@media (min-width:768px){.css-p5b1u1{margin-bottom:1rem;}}</style><div class="css-p5b1u1 gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:128px;height:128px"><img aria-hidden="true" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAE50lEQVQ4y0WU+U/TdxjHq86ZzB9mXLYscYvLZjymcU4TN4/oyMRr4sSbdSKnomIRszEZbg4QuQ+BUm7aUsollBYKpVAKlEMQ5HbqpmZzLvtx2T/w2tMvoL/2m74+z/N+3u+3KvmGhnJtPLX6VAac5Twba+bJqJUnI008uWfh9+FGfhtq4NFgPQ/6apjqqWLCXcn9Tj3DjlIGWorotRTQVZ9HR00Oqp9iwjHo4tHlxGEsTmC4Q89TgXlB88DHd+/wcKCWGU81k91VjHcZXwHtRXiaCnDfyaOzVoARoce4dSMSW1U6bfU5OBtzBdTIs9Emnt33TuqFNgi0fg5qFqiJ0Y6KOWChALUKsKMmG1VooB/GokRGXSam5PXB1mL5g5HpXhPTst50j4lJt5GJLgPjMtVIeykjIo13wqG2Elm5kN6mfFk5dxa4ffvHmMtu8s+DTgbtZbSbs+RDJtkJkcRGfcuPmgCuhn/Nze/PkvjdWX6+eobOuhzGXHruyuP9zTp6LHm46m7jrM5CtXvbKgyFifw50SZrGHE35gs0jaS4c0SEHiVEvR/1sd2cPbWH4ABfgk770lyZwrgAvfr12QroFpleArd9uhKLKZu/ppyMdhplfJ0AM0i+fh7N+ZOEBx4k8IQPoQIL+2Yv4fKA3ZQqK5fTL+t6rFoF6J263Qv0272OLmuxArwvOnqshbhFj2tRaiJC/LkQ7EfIaR/CAvZwTr2XiMADtIskI85SPC06BehuuK1c2FEjQM3xrfQ5ynk+6WTcbcZjExtY8kn4IZhL544SduYgqz9awVvLl7Fm1XsEnfTBUpbAPTmOx5qv6Nd1J0d0z6KtKgPVJf8tDDr1PJcJJ3tqGGwplsvpuBUXRlTEcU75+6BSLWDJ4sUsXLiQQ3u2YK1IZKi1SGC5orlMV5cl62ZiF+upLh7ZzLDLqEw4JcC7rSVy7UKyEyPRCDDoxJesXbGMg5tWot65jgjR0l4lqWoWMzfk4KoXV9Rm4BDdW0xpqKJOfs6EJODFdAfTnlrFCt7XtSnRXA4/KkfYR+Dhz6hMi+Kx+DHu0nGs+iT6bdo5WCbOmnQcMl1zZSqqYL8tPJIkvJjpZKavTjHrcHsJurSrRF84weWwwxzz/QRzykWGqpPw37eDZmOKpEOiVpc5C5R1HaKf93fVoR2rmemvUYC/DjSI2GVKGkqzYggKOMD6dR+y/M2lWOPVuNJDWL92A3lJV0QWLc7aeaAcxJSOzSBA360fMOAo4e8HLgU44qzgYZ+Z+JhQFixazGuvv8G7b79DdJg/PWLiC0EBZP2iEVMXzK2bKb7NpLUyjWZ9Mqpdm96nW+Lz3x8jUgYOxrpMPB+3iQ+DWLRkKds3b+T66S+IDT/Cv49biYsOl4NFiam1c8AMZV27MXUW+NWuNdIwOfQ4ixiUOE0P1Eli9DKNjm7x5GBbqdRVuXjUwES3gR7xntsiVnl5kFdAmxd4JnAjsTf2k54ViNuuo7IgjoQYKYD6bJ7eaxArSVV1VjAksvQKzCPN0m3JVQ6iXNcstSd2aRH9bBW3xNianZjLYxmR2CXHBRGm9qE0M0auXaaU6ZjLMNd9JUr3zZaBtIs86J2wvTqNVsl2i2FuZW1SpPgnieKMi1zT+JOXfAWrIUPCb1Dq3tvOL4Ets8D5uM0mJF258LyG/wMQ4lRaLX4Z6QAAAABJRU5ErkJggg==" alt="profileImg" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><noscript><picture><source srcset="/static/88a66867dae51fb125504f10c9702215/2c344/profile.png 1x,
/static/88a66867dae51fb125504f10c9702215/f20a7/profile.png 1.5x,
/static/88a66867dae51fb125504f10c9702215/714e6/profile.png 2x" /><img loading="lazy" width="128" height="128" srcset="/static/88a66867dae51fb125504f10c9702215/2c344/profile.png 1x,
/static/88a66867dae51fb125504f10c9702215/f20a7/profile.png 1.5x,
/static/88a66867dae51fb125504f10c9702215/714e6/profile.png 2x" src="/static/88a66867dae51fb125504f10c9702215/2c344/profile.png" alt="profileImg" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><div><span>Written by </span><style data-emotion-css="1t4jyca">.css-1t4jyca{display:inline-block;font-size:1.25rem;font-weight:700;border-radius:9999px;margin-bottom:0.5rem;padding-left:0.75rem;padding-right:0.75rem;--bg-opacity:1;background-color:rgba(237,242,247,var(--bg-opacity));color:#3737B9;}</style><p class="css-1t4jyca">@<!-- -->Seongwon</p><style data-emotion-css="vg2p6i">.css-vg2p6i{font-size:0.875rem;font-weight:400;margin-bottom:0.5rem;}</style><div class="css-vg2p6i">기술공유를 통해 새로운 가치 창조을 추구하는 백엔드 개발자 오성원입니다.</div></div></div><style data-emotion-css="1air669">.css-1air669{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-left:0.5rem;margin-right:0.5rem;}</style><div class="css-1air669"><div class="css-1i57it9"></div></div><style data-emotion-css="1baulvz">.css-1baulvz{display:inline-block;}</style><a title="github Link" href="https://github.com/Seongwon97" class="css-1baulvz"><style data-emotion-css="vnd1fq">.css-vnd1fq{width:2rem;height:2rem;margin-top:1rem;margin-left:1rem;-webkit-transition:all 300ms cubic-bezier(0,0,0.2,1);transition:all 300ms cubic-bezier(0,0,0.2,1);color:#888;}.css-vnd1fq:hover{color:#000;}</style><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" class="css-vnd1fq" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a><a title="facebook Link" href="https://www.facebook.com/profile.php?id=100004105792447" class="css-1baulvz"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="css-vnd1fq" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"></path></svg></a></div><style data-emotion-css="18jj1tc">.css-18jj1tc{margin-top:1.25rem;margin-left:0.5rem;margin-right:0.5rem;}</style><div class="css-18jj1tc"><div class="utterances"></div></div></div></div><style data-emotion-css="xgi74q">.css-xgi74q{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;position:fixed;bottom:0;right:0;padding-right:1.5rem;padding-bottom:1.5rem;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;}</style><div class="css-xgi74q el51cds0"><style data-emotion-css="1a68u">.css-1a68u{box-shadow:0 2px 2px 0 rgba(0,0,0,0.15);-webkit-transition:all 300ms cubic-bezier(0.4,0,0.2,1);transition:all 300ms cubic-bezier(0.4,0,0.2,1);background-color:#FFFFFF;color:#636363;font-size:0.75rem;padding-left:0.5rem;padding-right:0.5rem;padding-top:0.5rem;padding-bottom:0.5rem;border-radius:9999px;--transform-translate-x:0;--transform-translate-y:0;--transform-rotate:0;--transform-skew-x:0;--transform-skew-y:0;--transform-scale-x:1;--transform-scale-y:1;-webkit-transform:translateX(var(--transform-translate-x)) translateY(var(--transform-translate-y)) rotate(var(--transform-rotate)) skewX(var(--transform-skew-x)) skewY(var(--transform-skew-y)) scaleX(var(--transform-scale-x)) scaleY(var(--transform-scale-y));-ms-transform:translateX(var(--transform-translate-x)) translateY(var(--transform-translate-y)) rotate(var(--transform-rotate)) skewX(var(--transform-skew-x)) skewY(var(--transform-skew-y)) scaleX(var(--transform-scale-x)) scaleY(var(--transform-scale-y));transform:translateX(var(--transform-translate-x)) translateY(var(--transform-translate-y)) rotate(var(--transform-rotate)) skewX(var(--transform-skew-x)) skewY(var(--transform-skew-y)) scaleX(var(--transform-scale-x)) scaleY(var(--transform-scale-y));cursor:pointer;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-content:flex-end;-ms-flex-line-pack:end;align-content:flex-end;z-index:100;}.css-1a68u:hover{background-color:#404040;color:#FFFFFF;}.css-1a68u:hover{--transform-scale-x:1.05;--transform-scale-y:1.05;}</style><button title="change to darkmode" class="css-1a68u"><style data-emotion-css="1alqh2e">.css-1alqh2e{fill:currentColor;--text-opacity:1;color:rgba(246,224,94,var(--text-opacity));width:1rem;height:1rem;margin-top:auto;margin-bottom:auto;margin-left:0;margin-right:0;}@media (min-width:768px){.css-1alqh2e{display:inline-block;margin-left:0.25rem;margin-right:0.25rem;}}</style><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="css-1alqh2e" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg><style data-emotion-css="flxr9x">.css-flxr9x{display:none;margin-right:0;}@media (min-width:768px){.css-flxr9x{display:inline-block;margin-right:0.25rem;}}</style><span class="css-flxr9x">다크 모드로 보기</span></button><style data-emotion-css="15afv4q">.css-15afv4q{box-shadow:0 2px 2px 0 rgba(0,0,0,0.15);-webkit-transition:all 300ms cubic-bezier(0.4,0,0.2,1);transition:all 300ms cubic-bezier(0.4,0,0.2,1);background-color:#FFFFFF;color:#636363;font-size:0.75rem;padding-left:0.5rem;padding-right:0.5rem;padding-top:0.5rem;padding-bottom:0.5rem;border-radius:9999px;--transform-translate-x:0;--transform-translate-y:0;--transform-rotate:0;--transform-skew-x:0;--transform-skew-y:0;--transform-scale-x:1;--transform-scale-y:1;-webkit-transform:translateX(var(--transform-translate-x)) translateY(var(--transform-translate-y)) rotate(var(--transform-rotate)) skewX(var(--transform-skew-x)) skewY(var(--transform-skew-y)) scaleX(var(--transform-scale-x)) scaleY(var(--transform-scale-y));-ms-transform:translateX(var(--transform-translate-x)) translateY(var(--transform-translate-y)) rotate(var(--transform-rotate)) skewX(var(--transform-skew-x)) skewY(var(--transform-skew-y)) scaleX(var(--transform-scale-x)) scaleY(var(--transform-scale-y));transform:translateX(var(--transform-translate-x)) translateY(var(--transform-translate-y)) rotate(var(--transform-rotate)) skewX(var(--transform-skew-x)) skewY(var(--transform-skew-y)) scaleX(var(--transform-scale-x)) scaleY(var(--transform-scale-y));cursor:pointer;margin-left:0.5rem;margin-top:auto;margin-bottom:auto;z-index:100;}.css-15afv4q:hover{background-color:#404040;color:#FFFFFF;}.css-15afv4q:hover{--transform-scale-x:1.05;--transform-scale-y:1.05;}</style><button title="top page" class="css-15afv4q"><style data-emotion-css="13htjwu">.css-13htjwu{width:1rem;height:1rem;}</style><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="css-13htjwu" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M868 545.5L536.1 163a31.96 31.96 0 0 0-48.3 0L156 545.5a7.97 7.97 0 0 0 6 13.2h81c4.6 0 9-2 12.1-5.5L474 300.9V864c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V300.9l218.9 252.3c3 3.5 7.4 5.5 12.1 5.5h81c6.8 0 10.5-8 6-13.2z"></path></svg></button></div><style data-emotion-css="1k8xcyw">.css-1k8xcyw{text-align:center;padding-top:2rem;padding-bottom:2rem;bottom:0;}</style><footer class="css-1k8xcyw"><style data-emotion-css="1xju3od">.css-1xju3od{font-size:0.75rem;font-weight:700;}</style><a href="https://github.com/Seongwon97" class="css-1xju3od">©SeongwonOh</a></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'G-GWY0BQE1WD', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/Spring-MVC/20230528-모두모여라_팀의_동시성문제_해결_과정/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-2f72579fb641bf14a0fa.js"],"app":["/app-dafb8249d5df2d36e2cc.js"],"component---src-pages-404-js":["/component---src-pages-404-js-7c870a7d2887aec81e13.js"],"component---src-pages-index-js":["/component---src-pages-index-js-00adaf82f0b474dbba85.js"],"component---src-pages-search-js":["/component---src-pages-search-js-0bd0fa40581866873b37.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-c13fb2d53b7ec5e4b38f.js"],"component---src-templates-category-js":["/component---src-templates-category-js-7ced1e41f0af300d999b.js"]};/*]]>*/</script><script src="/polyfill-2f72579fb641bf14a0fa.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-c13fb2d53b7ec5e4b38f.js" async=""></script><script src="/7a297f752dcfe258c0b0106d89edb3a916af916e-35686b2093ef54ff3248.js" async=""></script><script src="/commons-d4794f4d9e0af84805d6.js" async=""></script><script src="/1bfc9850-409296e666dade882413.js" async=""></script><script src="/5e2a4920-da90abce4a08c86a094c.js" async=""></script><script src="/d7eeaac4-dcbe97e7a5aa158c9d08.js" async=""></script><script src="/app-dafb8249d5df2d36e2cc.js" async=""></script><script src="/dc6a8720040df98778fe970bf6c000a41750d3ae-17eb047fb821ccbad0b0.js" async=""></script><script src="/styles-84a9bc99193fe5828ffe.js" async=""></script><script src="/framework-eb684e3e828ad13b3940.js" async=""></script><script src="/webpack-runtime-2da3c169fb26441916c3.js" async=""></script></body></html>