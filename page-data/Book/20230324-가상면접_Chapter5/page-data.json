{"componentChunkName":"component---src-templates-blog-post-js","path":"/Book/20230324-가상면접_Chapter5/","result":{"data":{"site":{"siteMetadata":{"author":"Seongwon","comment":{"utterances":"Seongwon97/Seongwon97.github.io"},"sponsor":{"buyMeACoffeeId":"seongwon"}}},"markdownRemark":{"excerpt":"Scale out을 하기 위해서는 요청 또는 데이터를 N개의 서버에 균등하게 나누는 것이 중요하다. 안정해시는 균등한 분배를 달성하기 위해 보편적으로 사용하는 기술이다. 해시 키 재배치(refresh) 문제 N개의 서버에 부하를 균등하게 나누는 보편적인 방법은 serverIndex = hash(key) % 서버의 개수 N 해시 함수를 사용하는 것이다. 해…","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 912px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 131.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB0klEQVRIx+2UXUojQRDH5/s7yTiT+dzEREUFFUkIMeq6q9kNgooIAcUXBQ/go4fwDN7DC3gGb+CTl/hb1SPR4LKwrruI+FB0T3fXr6r/XTWSJEl4Y/sE/g+gokpQtfec4cl5jovLKQSRXqzJrwDKj04TVR03dyu4Rx+Dg3AkwasztGwFV9cLuL7tYKnjFcGUv7yyqsowLeWzsD800DAV8dJ/BOTaUjV5VNDPi3t6zkWr68NxVQJL0HS56G8yRSlsDKhQ9Jl5F/UpG7WGRXNHWHPWwfySi8VWCd2vPpLcRHlCEy3I8yg1kdYsfJm0RbAR0CtpWNsKxIHGtINvgxDr/QDtVR/93Sq6Gz42BgHqTVs4eWUNGYGqiYk4sxBGBvxAfwIyfW0zQF63xGJv08fhWYbhaUoZetjaCbF/nGB4ktJ6jr2jWKwNTzPoRqEtA1kyAXQ9Fe2eL6Jy7/IPgeEsQUDRo9RArWmRBLYYOSOHfGK6EbekRiAGPmopwXZUITofWO5U8HMvQmulQlbG9+2QrhtisV3C+g+SoVcRcnA2fLNaw6Egjgg89soJaZHmFoKqQdqQxYbIhMckM0fzMB7f42/24Zd/UYdcJr+y3+3J8j/ulAeVMTK7lFneOQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/4d0c6b0a13788d3977702c683728c64c/8b69f/%EA%B0%80%EC%83%81_%EB%A9%B4%EC%A0%91_%EC%82%AC%EB%A1%80%EB%A1%9C_%EB%B0%B0%EC%9A%B0%EB%8A%94_%EB%8C%80%EA%B7%9C%EB%AA%A8_%EC%8B%9C%EC%8A%A4%ED%85%9C_%EC%84%A4%EA%B3%84_%EA%B8%B0%EC%B4%88.png\"\n        srcset=\"/static/4d0c6b0a13788d3977702c683728c64c/5a46d/%EA%B0%80%EC%83%81_%EB%A9%B4%EC%A0%91_%EC%82%AC%EB%A1%80%EB%A1%9C_%EB%B0%B0%EC%9A%B0%EB%8A%94_%EB%8C%80%EA%B7%9C%EB%AA%A8_%EC%8B%9C%EC%8A%A4%ED%85%9C_%EC%84%A4%EA%B3%84_%EA%B8%B0%EC%B4%88.png 300w,\n/static/4d0c6b0a13788d3977702c683728c64c/0a47e/%EA%B0%80%EC%83%81_%EB%A9%B4%EC%A0%91_%EC%82%AC%EB%A1%80%EB%A1%9C_%EB%B0%B0%EC%9A%B0%EB%8A%94_%EB%8C%80%EA%B7%9C%EB%AA%A8_%EC%8B%9C%EC%8A%A4%ED%85%9C_%EC%84%A4%EA%B3%84_%EA%B8%B0%EC%B4%88.png 600w,\n/static/4d0c6b0a13788d3977702c683728c64c/8b69f/%EA%B0%80%EC%83%81_%EB%A9%B4%EC%A0%91_%EC%82%AC%EB%A1%80%EB%A1%9C_%EB%B0%B0%EC%9A%B0%EB%8A%94_%EB%8C%80%EA%B7%9C%EB%AA%A8_%EC%8B%9C%EC%8A%A4%ED%85%9C_%EC%84%A4%EA%B3%84_%EA%B8%B0%EC%B4%88.png 912w\"\n        sizes=\"(max-width: 912px) 100vw, 912px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>Scale out을 하기 위해서는 요청 또는 데이터를 N개의 서버에 균등하게 나누는 것이 중요하다. 안정해시는 균등한 분배를 달성하기 위해 보편적으로 사용하는 기술이다.</p>\n<h1 id=\"해시-키-재배치refresh-문제\" style=\"position:relative;\"><a href=\"#%ED%95%B4%EC%8B%9C-%ED%82%A4-%EC%9E%AC%EB%B0%B0%EC%B9%98refresh-%EB%AC%B8%EC%A0%9C\" aria-label=\"해시 키 재배치refresh 문제 permalink\" class=\"toc-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>해시 키 재배치(refresh) 문제</h1>\n<p>N개의 서버에 부하를 균등하게 나누는 보편적인 방법은 <code>serverIndex = hash(key) % 서버의 개수 N</code> 해시 함수를 사용하는 것이다.</p>\n<p>해당 방법은 서버 풀(Server pool)의 크기가 고정되어 있을 때와 데이터 분포가 균등할 때 잘 동작한다. 하지만 서버가 추가되거나 삭제되면 키의 재분배가 필요해진다. 키의 재분배로 기존에 접속하던 서버와 다른 서버에 접속한다는 것은 대규모의 캐시 미스(cache miss)가 발생하게 된다.</p>\n<h1 id=\"안정-해시\" style=\"position:relative;\"><a href=\"#%EC%95%88%EC%A0%95-%ED%95%B4%EC%8B%9C\" aria-label=\"안정 해시 permalink\" class=\"toc-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>안정 해시</h1>\n<p>안정 해시는 키의 재배치 문재를 효과적으로 해결하는 기술이다.</p>\n<p>전통적인 해시 테이블은 슬롯의 수가 바뀌면 대부분의 키를 재배치하는 반면에 안정 해시(consistent hash)는 해시 테이블 크기가 조정될 때 평균적으로 오직 k/n개의 키만 재배치하는 해시 기술이다. (k는 키의 개수, n은 슬롯의 개수)</p>\n<h3 id=\"해시-공간과-해시-링\" style=\"position:relative;\"><a href=\"#%ED%95%B4%EC%8B%9C-%EA%B3%B5%EA%B0%84%EA%B3%BC-%ED%95%B4%EC%8B%9C-%EB%A7%81\" aria-label=\"해시 공간과 해시 링 permalink\" class=\"toc-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>해시 공간과 해시 링</h3>\n<p>해시를 사용하게 된다면 사용하는 해시 함수에 따라 만들어질 수 있는 범위가 만들어진다. 이를 <strong>해시 공간(hash space)</strong> 이라고 한다. 안정해시는 이러한 해시 공간을 원처럼 말아서 Circular Queue와 같은 형태로 링을 만들어 사용한다. 이를 <strong>해시 링(hash ring)</strong> 이라고 한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 69.33333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABDUlEQVQ4y6WU2aqGMAyE+/5PqHiheKXivu85fEKkiv5nGwhpm2Y6TaqmrmvxfV+qqhLXdSUMQ1nXVcC+7z82hZmmSTzPkziOZRiGw/4C8sqyFMMEdUmSyDiO0nWdNE1zemJ4blIUxZHU973keX6sqWmOUbmc0LbtSaJjvM5JhJDELMsuhByyLIuYbdsutdD6AcZsBPM8H0TfwXCi4ziSpulRR0wBCdcMgkCiKDqUIOCpYbpm7KCqBYypKR6lGqc0b6Qn4VvXNNGGktqElyvfJQOKy3N6uxox9tg5J6E9sQmp3xshsX8R3uO/JsTbX8y9LMTuZXokvKu8N0Yb8qbuo0J92DwdmoAxtn8cT6RfgyxOLeBCp8sAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/60e4f47776561e9aa28a0faf61a2104d/c1b63/img.png\"\n        srcset=\"/static/60e4f47776561e9aa28a0faf61a2104d/5a46d/img.png 300w,\n/static/60e4f47776561e9aa28a0faf61a2104d/0a47e/img.png 600w,\n/static/60e4f47776561e9aa28a0faf61a2104d/c1b63/img.png 1200w,\n/static/60e4f47776561e9aa28a0faf61a2104d/73a2e/img.png 1439w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h3 id=\"해시-서버\" style=\"position:relative;\"><a href=\"#%ED%95%B4%EC%8B%9C-%EC%84%9C%EB%B2%84\" aria-label=\"해시 서버 permalink\" class=\"toc-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>해시 서버</h3>\n<p>해시 서버는 서버들을 해시 함수에 서버의 IP나 이름을 대입해 링 위에 위치시킨 결과를 의미한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABRUlEQVQoz31S206EMBDl2/0CP8B34zf4qInRJxfffDG4yyKGdQV6o4Uee6NhAZlkMtPp9HTOaRNCCKqqQtu2KIoCWZahrmtYG4beRa21yYfoo2m/6WOwpGkapGnqgPI8R1mWYIzFBiGEW3POnTPjQnAMknkwHUC1h03wj/W0wvHpBlKqxV7HCfL7K5PU0IFBBBzpjEUdKLHmhPbjIVKeujXJGzMxi/uR8vTmcaPve3DRLZoxm8ZKYHunfauAsuvQGZ2s7PPp9LSv11BqEzDoZ1grvZxovianvdNzA9Dr1xxe8bO787WgaQRy0de+H68hqveLs+saki+Qz5fwv6aUh9hjo3CybDzK9CarDKUEszeJH5pSeqHf2Lc6oY9GcPOCFlSac93vAXT/7HJbU0qtnFmdUM/iAGmGbo9vOO9uXT6ymPda+wO6w6+2TNH/IgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/308b14c1c1ed99a2b0c86a76ca60f7ab/c1b63/img_1.png\"\n        srcset=\"/static/308b14c1c1ed99a2b0c86a76ca60f7ab/5a46d/img_1.png 300w,\n/static/308b14c1c1ed99a2b0c86a76ca60f7ab/0a47e/img_1.png 600w,\n/static/308b14c1c1ed99a2b0c86a76ca60f7ab/c1b63/img_1.png 1200w,\n/static/308b14c1c1ed99a2b0c86a76ca60f7ab/75b1f/img_1.png 1699w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h3 id=\"해시-키--서버\" style=\"position:relative;\"><a href=\"#%ED%95%B4%EC%8B%9C-%ED%82%A4--%EC%84%9C%EB%B2%84\" aria-label=\"해시 키  서버 permalink\" class=\"toc-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>해시 키 &#x26; 서버</h3>\n<p>안정 해시에서 사용하는 해시 함수는 나머지(modular)연산을 사용하지 않으며 키는 링 위에 어느 지점이던지 배치할 수 있다.</p>\n<p>키가 저장되는 서버는 키의 위치로부터 시계 방향으로 링을 탐색해서 만나는 첫 번째 서버에 저장되게 된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 73.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAABwElEQVQ4y3VTS0vEMBDOT/Ug+A8E7179D14EEUG8efDiRUFQFGEVH4u7WHW7Umubpknb5HP6yia1DrR5zOSb+ebBQGKMqf9oF9OdHZESSFNACFo5DJ3JqrVtAawpMx1Ar+j39VqUJb7f3vAxuYei/Rfts8UCSDigsXrj+GY2moEiSRJIpaA4RxZF0KSPgwDRxwLJww3E5QEsO4cV6y+bo6RH57t4PN7sYAfUe2fBLZ7210hdWDb9xyxFooRcIZ7fgc8uOu/aM24+rRudripkmVhF2a0WEAQYzeeEWbXK7qEZ5NUF4JSWsi6Yc7cCJI/TqytIMsKAhpUBcEoFep9MPHvmJlQK7hRnPH+uE60Nks8QKJR1xNxws3K8FYaAfd+ZSoK/vlBtSj+HDeNSYnm9B6jY68nRCHWb5/eTLYRnO13OKx9Q8Rjzww3on9mfonjRuUX5mkGloV8US4/ygUQgFfkoQNtCq7uyLJAJOdI2bvVygSL+xmI6haQJwWBOe6moI1Kabd1QN54j5s1xw11h+fyMKAybWa6ZV3lM1JaoiEWe5x2YHk0DG1bPOGeRpZD0LjjdRnC0Xk8mZJ79m9NafgFo6pcV8iCdMAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/3e1244d64f234e5ccddb4d96da3d275b/c1b63/img_2.png\"\n        srcset=\"/static/3e1244d64f234e5ccddb4d96da3d275b/5a46d/img_2.png 300w,\n/static/3e1244d64f234e5ccddb4d96da3d275b/0a47e/img_2.png 600w,\n/static/3e1244d64f234e5ccddb4d96da3d275b/c1b63/img_2.png 1200w,\n/static/3e1244d64f234e5ccddb4d96da3d275b/8b936/img_2.png 1368w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h3 id=\"서버-추가-및-제거\" style=\"position:relative;\"><a href=\"#%EC%84%9C%EB%B2%84-%EC%B6%94%EA%B0%80-%EB%B0%8F-%EC%A0%9C%EA%B1%B0\" aria-label=\"서버 추가 및 제거 permalink\" class=\"toc-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>서버 추가 및 제거</h3>\n<p>위와 같이 키가 시계 방향으로 이동하며 만나는 첫번째 서버로 배치되는 구조는 서버의 추가 및 제거가 될 때, 전체가 아닌 일부 키들에만 영향을 주게 된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABrklEQVQoz1VS227TQBD1/7/zExUPFTy1TwgJiUsLSBUkQbSUxE7s2Im99l68Nx9mx46AtUY73jl7ZvbMZNM04bJiBHS5g94+sJ/WJf4vzmqNcZAwUiGG/3EZ/3hDgBIWEeb0DLl7D9WdYQ5fKfgX7IcKuj/C0eeDIhuh22fY47eFNM6ERhQQm3eYarpURwLQ3mn0+T3ixIx8oS++wJRPcL8BserQrQaoxxKyebyUiSxYC9FQ1npCfrVF/apE87KCXTvGDHXDu2xbyL4nXYDy9oDmpkFFWLsJ8ESkKM5PDiHCu7kCaT32xw7GLwlJICl6zhwCmU/CTjgrgV/FFoM1jAtGQ1flXKHXZ6jingNaPaDIX6NrPy1AAfHjhn1zXJNt2D/V11ivXmCfX81N+vwB6vZ6rjBaCXn4nrSHMRto8wZKf0w9p8pJfC3mhsga6pSzP44VQjxhTGITbqSuh17wmGSXUWj3xTwqyWgUHD1vtCMnSt1Ly5EkXVXxWdQdovNEbuGIEN7zecYjQRem4JEkGvI79Lu7xLkQTQvp3O1IujrSvX96C7P/iUBJmGyZhD9tNLaED/L5LQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/28aed2e0c30964cafa330e7f86845391/c1b63/img_3.png\"\n        srcset=\"/static/28aed2e0c30964cafa330e7f86845391/5a46d/img_3.png 300w,\n/static/28aed2e0c30964cafa330e7f86845391/0a47e/img_3.png 600w,\n/static/28aed2e0c30964cafa330e7f86845391/c1b63/img_3.png 1200w,\n/static/28aed2e0c30964cafa330e7f86845391/d61c2/img_3.png 1800w,\n/static/28aed2e0c30964cafa330e7f86845391/88745/img_3.png 2148w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h3 id=\"기본-구현법의-문제\" style=\"position:relative;\"><a href=\"#%EA%B8%B0%EB%B3%B8-%EA%B5%AC%ED%98%84%EB%B2%95%EC%9D%98-%EB%AC%B8%EC%A0%9C\" aria-label=\"기본 구현법의 문제 permalink\" class=\"toc-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>기본 구현법의 문제</h3>\n<ul>\n<li>서버와 키를 균등 배포 해시 함수를 사용해 해시 링에 배치한다.</li>\n<li>키의 위치에서 링을 시계 방향으로 탐색하여 처음 만나는 서버에 키를 저장한다.</li>\n</ul>\n<p>안정 해시 알고리즘이 처음 제안된 기본 절차는 위와 같다. 하지만 해당 방법에는 서버가 추가되거나 삭제되는 상황을 고려했을 때 <strong>파티션(partition)의 크기를 균등하게 유지하는게 불가능하다</strong>는 문제가 있다. 자세히 설명하면 초기에 서버를 균등하게 위치시켰다 하더라도 중간에 서버를 추가하거나 삭제를 하면 특정 서버들은 할당받을 수 있는 키의 범위(해시 공간)이 다른 서버들과 비교하였을 때, 작거나 많아질 수 있는 문제가 발생하는 것이다.</p>\n<p>또한 <strong>키의 균등 분포를 달성하기가 어렵다</strong>는 문제도 존재한다. <code>해시 키 &#x26; 서버</code> 에서 보였던 사진만 살펴봐도 S3서버는 어떠한 키도 분배받지 못한 반면에 S1서버는 2개의 키를 저장하고 있는 것을 확인할 수 있다.</p>\n<h3 id=\"가상-노드\" style=\"position:relative;\"><a href=\"#%EA%B0%80%EC%83%81-%EB%85%B8%EB%93%9C\" aria-label=\"가상 노드 permalink\" class=\"toc-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>가상 노드</h3>\n<p>가상 노드(virtual node)는 기본 구현법의 문제를 해결하기 위해 제안된 방법이다.</p>\n<p>가상 노드는 실제 노드 또는 서버를 가리키는 노드로 하나의 서버는 링 위에 여러 개의 가상 노드를 가질 수 있다. 이와 같이 각각의 서버들은 여러 개의 가상 노드를 갖고 각각의 가상 노드가 갖는 여러개의 파티션들을 관리하게 된다.</p>\n<p>가상 노드의 개수를 늘리면 늘릴 수록 표준 편차가 작아져서 키의 분포는 점점 더 균등해진다. 하지만 가상 노드 데이터를 저장할 공간이 점점 더 많이 필요해진다는 tradeoff한 문제가 있어 시스템 요구사항에 맞게 적절한 개수를 정해야 한다.</p>\n<h2 id=\"안정-해시의-이점\" style=\"position:relative;\"><a href=\"#%EC%95%88%EC%A0%95-%ED%95%B4%EC%8B%9C%EC%9D%98-%EC%9D%B4%EC%A0%90\" aria-label=\"안정 해시의 이점 permalink\" class=\"toc-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>안정 해시의 이점</h2>\n<ul>\n<li>서버가 추가되거나 삭제될 때 재배치되는 키의 수가 최소화된다.</li>\n<li>데이터가 보다 균등하게 분포하게 되어 수평적 규모 확장성을 달성하기 쉽다.</li>\n<li>핫스팟(Hotspot)키 문제를 줄여준다. 특정한 샤드(shard)에 대한 접근이 지나치게 빈번하면 서버 과부하 문제가 생길 수 있다. 안정 해시는 데이터를 좀 더 균등하게 분배하므로 이런 문제가 생길 가능성을 줄인다.</li>\n</ul>\n<h2 id=\"안정-해시를-사용하는-대표적인-예\" style=\"position:relative;\"><a href=\"#%EC%95%88%EC%A0%95-%ED%95%B4%EC%8B%9C%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94-%EB%8C%80%ED%91%9C%EC%A0%81%EC%9D%B8-%EC%98%88\" aria-label=\"안정 해시를 사용하는 대표적인 예 permalink\" class=\"toc-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>안정 해시를 사용하는 대표적인 예</h2>\n<ul>\n<li>아마존 다이나모 데이터베이스(DynamoDB)ㅋ의 파티셔닝 관련 컴포넌트</li>\n<li>Apach Cassandra 클러스터에서의 데이터 파티셔닝</li>\n<li>Discord 채팅 어플리케이션</li>\n<li>Akamai CDN</li>\n<li>Meglev 네트워크 부하 분산기</li>\n</ul>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n</style>","tableOfContents":"<ul>\n<li><a href=\"/Book/20230324-%EA%B0%80%EC%83%81%EB%A9%B4%EC%A0%91_Chapter5/#%ED%95%B4%EC%8B%9C-%ED%82%A4-%EC%9E%AC%EB%B0%B0%EC%B9%98refresh-%EB%AC%B8%EC%A0%9C\">해시 키 재배치(refresh) 문제</a></li>\n<li>\n<p><a href=\"/Book/20230324-%EA%B0%80%EC%83%81%EB%A9%B4%EC%A0%91_Chapter5/#%EC%95%88%EC%A0%95-%ED%95%B4%EC%8B%9C\">안정 해시</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"/Book/20230324-%EA%B0%80%EC%83%81%EB%A9%B4%EC%A0%91_Chapter5/#%ED%95%B4%EC%8B%9C-%EA%B3%B5%EA%B0%84%EA%B3%BC-%ED%95%B4%EC%8B%9C-%EB%A7%81\">해시 공간과 해시 링</a></li>\n<li><a href=\"/Book/20230324-%EA%B0%80%EC%83%81%EB%A9%B4%EC%A0%91_Chapter5/#%ED%95%B4%EC%8B%9C-%EC%84%9C%EB%B2%84\">해시 서버</a></li>\n<li><a href=\"/Book/20230324-%EA%B0%80%EC%83%81%EB%A9%B4%EC%A0%91_Chapter5/#%ED%95%B4%EC%8B%9C-%ED%82%A4--%EC%84%9C%EB%B2%84\">해시 키 &#x26; 서버</a></li>\n<li><a href=\"/Book/20230324-%EA%B0%80%EC%83%81%EB%A9%B4%EC%A0%91_Chapter5/#%EC%84%9C%EB%B2%84-%EC%B6%94%EA%B0%80-%EB%B0%8F-%EC%A0%9C%EA%B1%B0\">서버 추가 및 제거</a></li>\n<li><a href=\"/Book/20230324-%EA%B0%80%EC%83%81%EB%A9%B4%EC%A0%91_Chapter5/#%EA%B8%B0%EB%B3%B8-%EA%B5%AC%ED%98%84%EB%B2%95%EC%9D%98-%EB%AC%B8%EC%A0%9C\">기본 구현법의 문제</a></li>\n<li><a href=\"/Book/20230324-%EA%B0%80%EC%83%81%EB%A9%B4%EC%A0%91_Chapter5/#%EA%B0%80%EC%83%81-%EB%85%B8%EB%93%9C\">가상 노드</a></li>\n</ul>\n</li>\n<li><a href=\"/Book/20230324-%EA%B0%80%EC%83%81%EB%A9%B4%EC%A0%91_Chapter5/#%EC%95%88%EC%A0%95-%ED%95%B4%EC%8B%9C%EC%9D%98-%EC%9D%B4%EC%A0%90\">안정 해시의 이점</a></li>\n<li><a href=\"/Book/20230324-%EA%B0%80%EC%83%81%EB%A9%B4%EC%A0%91_Chapter5/#%EC%95%88%EC%A0%95-%ED%95%B4%EC%8B%9C%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94-%EB%8C%80%ED%91%9C%EC%A0%81%EC%9D%B8-%EC%98%88\">안정 해시를 사용하는 대표적인 예</a></li>\n</ul>\n</li>\n</ul>","frontmatter":{"date":"2023년 03월 23일","title":"[가상 면접 사례로 배우는 대규모 시스템 설계 기초] 5장. 안정 해시 설계","tags":["가상 면접 사례로 배우는 대규모 시스템 설계 기초"]}}},"pageContext":{"slug":"/Book/20230324-가상면접_Chapter5/","previous":{"fields":{"slug":"/Book/20230322-가상면접_Chapter3/"},"frontmatter":{"title":"[가상 면접 사례로 배우는 대규모 시스템 설계 기초] 3장. 시스템 설계 면접 공략법"}},"next":{"fields":{"slug":"/Book/20230323-가상면접_Chapter4/"},"frontmatter":{"title":"[가상 면접 사례로 배우는 대규모 시스템 설계 기초] 4장. 처리율 제한 장치의 설계"}}}},"staticQueryHashes":["3911196313","4111100897"]}